<div class="flex-1 overflow-y-auto p-8 fade-in relative">
    <!-- 로딩 인디케이터 (Fixed Position) -->
    <div id="loading-indicator" class="htmx-indicator fixed inset-0 bg-gray-950/90 z-[100] flex flex-col items-center justify-center backdrop-blur-sm">
        <div class="text-center space-y-4">
            <div class="relative w-24 h-24 mx-auto mb-6">
                <div class="absolute inset-0 border-t-4 border-blue-500 border-solid rounded-full animate-spin"></div>
                <div class="absolute inset-2 border-b-4 border-indigo-500 border-solid rounded-full animate-spin" style="animation-direction: reverse;"></div>
                <i data-lucide="dices" class="absolute inset-0 m-auto text-white w-8 h-8 animate-bounce"></i>
            </div>
            <h3 class="text-2xl font-bold text-white">시나리오 생성 중...</h3>
            <p class="text-blue-300 text-sm animate-pulse">
                세계관 설정 분석 중...<br>
                NPC 페르소나 주입 중...<br>
                분기점 논리 회로 구성 중...
            </p>
        </div>
    </div>

    <div class="max-w-4xl mx-auto space-y-6">
        <div class="flex items-end justify-between border-b border-gray-800 pb-4">
            <div>
                <h2 class="text-3xl font-bold text-white">시나리오 빌더</h2>
                <p class="text-gray-400 mt-1">AI GM에게 전달할 시나리오의 뼈대를 구성합니다.</p>
            </div>
        </div>

        <form hx-post="/api/init_game"
              hx-target="#init-result"
              hx-indicator="#loading-indicator"
              class="space-y-8 pb-12">

            <!-- 1. 기본 설정 -->
            <div class="bg-gray-900 p-6 rounded-xl border border-gray-800 space-y-4">
                <h3 class="text-lg font-bold text-blue-400 flex items-center gap-2">
                    <i data-lucide="settings"></i> 기본 설정
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-300">1. 주사위 시스템 선택</label>
                        <select name="dice_system" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="1d20">D20 (D&D 5e 스타일)</option>
                            <option value="2d6">2D6 (PbtA / 던전월드 스타일)</option>
                            <option value="1d100">D100 (CoC / 백분율 스타일)</option>
                            <option value="story">주사위 없음 (스토리 중심)</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-300">2. 시나리오 이름</label>
                        <input type="text" name="title" required placeholder="예: 잊혀진 광산의 메아리"
                               class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div class="col-span-1 md:col-span-2 space-y-2">
                        <label class="block text-sm font-semibold text-gray-300">3. 시나리오 배경 (테마 및 분위기)</label>
                        <textarea name="background" rows="2" required placeholder="예: 2077년 네온사인이 가득한 사이버펑크 도시, 기업의 음모가 도사리고 있다."
                                  class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 outline-none resize-none"></textarea>
                    </div>
                </div>
            </div>

            <!-- 2. 룰 및 난이도 -->
            <div class="bg-gray-900 p-6 rounded-xl border border-gray-800 space-y-4">
                <h3 class="text-lg font-bold text-indigo-400 flex items-center gap-2">
                    <i data-lucide="scroll"></i> 룰 & 난이도
                </h3>

                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-300">4. 공통 룰 (하우스 룰)</label>
                    <textarea name="common_rules" rows="2" placeholder="예: 마법 사용 시 정신력이 소모됨. 휴식은 안전한 곳에서만 가능."
                              class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none resize-none"></textarea>
                </div>

                <div class="space-y-3">
                    <label class="block text-sm font-semibold text-gray-300">5. 플레이어 난이도 (총 스탯 수치)</label>
                    <div class="grid grid-cols-3 gap-4">
                        <label class="cursor-pointer">
                            <input type="radio" name="difficulty" value="easy" class="peer sr-only" checked>
                            <div class="p-4 rounded-lg border border-gray-700 bg-gray-800 peer-checked:bg-green-900 peer-checked:border-green-500 hover:bg-gray-700 transition-all text-center">
                                <div class="font-bold text-green-400 mb-1">EASY</div>
                                <div class="text-xs text-gray-400">총 스탯 높음<br>(유리한 판정)</div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="difficulty" value="normal" class="peer sr-only">
                            <div class="p-4 rounded-lg border border-gray-700 bg-gray-800 peer-checked:bg-blue-900 peer-checked:border-blue-500 hover:bg-gray-700 transition-all text-center">
                                <div class="font-bold text-blue-400 mb-1">NORMAL</div>
                                <div class="text-xs text-gray-400">표준 스탯<br>(균형 잡힘)</div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="difficulty" value="hard" class="peer sr-only">
                            <div class="p-4 rounded-lg border border-gray-700 bg-gray-800 peer-checked:bg-red-900 peer-checked:border-red-500 hover:bg-gray-700 transition-all text-center">
                                <div class="font-bold text-red-400 mb-1">HARD</div>
                                <div class="text-xs text-gray-400">총 스탯 낮음<br>(가혹한 판정)</div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- 3. 씬 구성 요소 (사용자 입력형으로 수정됨) -->
            <div class="bg-gray-900 p-6 rounded-xl border border-gray-800 space-y-4">
                <h3 class="text-lg font-bold text-purple-400 flex items-center gap-2">
                    <i data-lucide="clapperboard"></i> 씬(Scene) 생성 가이드라인
                </h3>
                <p class="text-xs text-gray-500">각 씬을 생성할 때 필수적으로 포함되어야 할 요소를 입력하세요. (체크 해제 시 제외)</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- 6-1. 배경 -->
                    <div class="bg-gray-800 p-3 rounded-lg border border-gray-700 flex items-center gap-3 transition-colors focus-within:border-purple-500">
                        <input type="checkbox" checked class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500 bg-gray-700 border-gray-600 shrink-0"
                               onchange="document.getElementById('req_1').disabled = !this.checked; document.getElementById('req_1').classList.toggle('opacity-50')">
                        <div class="flex-1">
                            <input type="text" id="req_1" name="scene_req_desc" value="씬 배경 묘사 (시간, 날씨, 장소의 분위기 서술)"
                                   class="w-full bg-transparent text-sm text-gray-200 border-none outline-none focus:ring-0 placeholder-gray-500">
                        </div>
                    </div>

                    <!-- 6-2. NPC -->
                    <div class="bg-gray-800 p-3 rounded-lg border border-gray-700 flex items-center gap-3 transition-colors focus-within:border-purple-500">
                        <input type="checkbox" checked class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500 bg-gray-700 border-gray-600 shrink-0"
                               onchange="document.getElementById('req_2').disabled = !this.checked; document.getElementById('req_2').classList.toggle('opacity-50')">
                        <div class="flex-1">
                            <input type="text" id="req_2" name="scene_req_npc" value="NPC 등장 및 상호작용 (상황에 맞는 대화)"
                                   class="w-full bg-transparent text-sm text-gray-200 border-none outline-none focus:ring-0 placeholder-gray-500">
                        </div>
                    </div>

                    <!-- 6-3. 아이템/판정 -->
                    <div class="bg-gray-800 p-3 rounded-lg border border-gray-700 flex items-center gap-3 transition-colors focus-within:border-purple-500">
                        <input type="checkbox" checked class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500 bg-gray-700 border-gray-600 shrink-0"
                               onchange="document.getElementById('req_3').disabled = !this.checked; document.getElementById('req_3').classList.toggle('opacity-50')">
                        <div class="flex-1">
                            <input type="text" id="req_3" name="scene_req_items" value="키 아이템 체크 & 스탯 기반 행동 판정"
                                   class="w-full bg-transparent text-sm text-gray-200 border-none outline-none focus:ring-0 placeholder-gray-500">
                        </div>
                    </div>

                    <!-- 6-4. 분기점 -->
                    <div class="bg-gray-800 p-3 rounded-lg border border-gray-700 flex items-center gap-3 transition-colors focus-within:border-purple-500">
                        <input type="checkbox" checked class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500 bg-gray-700 border-gray-600 shrink-0"
                               onchange="document.getElementById('req_4').disabled = !this.checked; document.getElementById('req_4').classList.toggle('opacity-50')">
                        <div class="flex-1">
                            <input type="text" id="req_4" name="scene_req_branch" value="명확한 성공/실패/선택에 따른 분기 제공"
                                   class="w-full bg-transparent text-sm text-gray-200 border-none outline-none focus:ring-0 placeholder-gray-500">
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. 상세 컨텐츠 -->
            <div class="bg-gray-900 p-6 rounded-xl border border-gray-800 space-y-4">
                <h3 class="text-lg font-bold text-green-400 flex items-center gap-2">
                    <i data-lucide="users"></i> 상세 컨텐츠 설정
                </h3>

                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-300">7. 주요 NPC 설정</label>
                    <textarea name="npc_list" rows="3" placeholder="예: 주점 주인 '바라스' (무뚝뚝함, 정보통), 경비대장 '카일' (뇌물 좋아함)"
                              class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-green-500 outline-none resize-none"></textarea>
                </div>

                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-300">8. 엔딩 조건 및 묘사</label>
                    <textarea name="ending_desc" rows="2" placeholder="예: 유물을 찾으면 해피 엔딩, 시간 내 못 찾으면 도시가 파괴되는 배드 엔딩"
                              class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-green-500 outline-none resize-none"></textarea>
                </div>
            </div>

            <button type="submit"
                    class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-5 rounded-lg shadow-lg transform transition-all hover:scale-[1.01] flex justify-center items-center gap-3 text-lg">
                <i data-lucide="sparkles" class="w-6 h-6"></i>
                설정 완료: 시나리오 생성 시작
            </button>
        </form>

        <div id="init-result" class="text-center min-h-[50px]"></div>
    </div>
</div>