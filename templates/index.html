<!DOCTYPE html>
<html lang="ko" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRPG Studio - The Core</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=DotGothic16&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    /* ... colors ì„¤ì • ìƒëµ ... */
                    colors: {
                        rpg: {
                            900: '#0B0B19',
                            800: '#1A0B2E',
                            700: '#2D1B4E',
                            accent: '#00FFFF',
                            hover: '#00DDDD',
                            danger: '#FF007F',
                        }
                    },
                    /* [â–¼ ìˆ˜ì •] animation ë° keyframes ì¶”ê°€ */
                    animation: {
                        'slide-infinite': 'slide 100s linear infinite',
                        'float': 'float 6s ease-in-out infinite', /* ë‘¥ë‘¥ ëœ¨ëŠ” íš¨ê³¼ */
                    },
                    keyframes: {
                        slide: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-100%)' }
                        },
                        /* ë‘¥ë‘¥ ëœ¨ëŠ” í‚¤í”„ë ˆì„ ì¶”ê°€ */
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* 8-bit Pixel Art Base */
        body {
            background: linear-gradient(180deg, #0B0B19 0%, #1A0B2E 50%, #0B0B19 100%) !important;
            color: #e2e8f0 !important;
            font-family: 'DotGothic16', sans-serif;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        /* CRT Effect - Scanlines */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(0deg,
                    rgba(0, 0, 0, 0.15),
                    rgba(0, 0, 0, 0.15) 1px,
                    transparent 1px,
                    transparent 2px);
            pointer-events: none;
            z-index: 9999;
        }

        /* Pixel Border Effect */
        .pixel-border {
            border: 3px solid currentColor;
            border-radius: 0 !important;
            box-shadow:
                4px 4px 0 rgba(0, 0, 0, 0.3),
                8px 8px 0 rgba(0, 0, 0, 0.2),
                12px 12px 0 rgba(0, 0, 0, 0.1);
        }

        .pixel-btn {
            background: transparent;
            border: 3px solid currentColor;
            color: #FFFACD;
            font-family: 'Press Start 2P', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 8px 16px;
            transition: all 0.2s;
            position: relative;
            border-radius: 0 !important;
        }

        .pixel-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow:
                2px 2px 0 rgba(0, 0, 0, 0.3),
                4px 4px 0 rgba(0, 0, 0, 0.2);
        }

        .pixel-input {
            background: rgba(26, 11, 46, 0.8) !important;
            border: 2px solid #4A4A6A !important;
            color: #FFFACD !important;
            font-family: 'DotGothic16', sans-serif;
            border-radius: 0 !important;
            padding: 8px 12px !important;
        }

        .pixel-input:focus {
            border-color: #00FFFF !important;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.3) !important;
            outline: none !important;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .modal {
            transition: opacity 0.25s ease;
        }

        body.modal-active {
            overflow: hidden;
        }

        /* ë©”ì¸ í™”ë©´ ìŠ¬ë¼ì´ë“œ ì»¨í…Œì´ë„ˆ */
        .horizontal-scroll-container {
            display: flex;
            overflow-x: auto;
            gap: 1.5rem;
            padding: 20px 10px 40px 10px !important;
            margin: -20px -10px 0 -10px !important;
            cursor: grab;
            -webkit-user-select: none;
            user-select: none;
            scroll-behavior: smooth;
        }

        .horizontal-scroll-container.active {
            cursor: grabbing;
            scroll-behavior: auto;
        }

        /* API ì¹´ë“œ ë””ìì¸ - 8-bit style */
        .scenario-card-base {
            background-color: #1A0B2E !important;
            border: 3px solid #4A4A6A !important;
            border-radius: 0 !important;
            overflow: hidden !important;
            box-shadow:
                4px 4px 0 rgba(0, 0, 0, 0.5),
                8px 8px 0 rgba(0, 0, 0, 0.3) !important;
            transition: all 0.2s ease !important;
            display: flex !important;
            flex-direction: column !important;

            /* w-64 (256px) + ì—¬ë°± = 4ê°œ ë°°ì¹˜ */
            min-width: 16rem !important;
            width: 16rem !important;

            margin-right: 1.5rem !important;
            flex-shrink: 0 !important;
        }

        .scenario-card-base:hover {
            border-color: #00FFFF !important;
            box-shadow:
                2px 2px 0 rgba(0, 0, 0, 0.5),
                4px 4px 0 rgba(0, 0, 0, 0.3),
                0 0 16px rgba(0, 255, 255, 0.4) !important;
            transform: translate(-2px, -2px) !important;
        }

        /* Lucide Icons - Thick Stroke */
        [data-lucide] {
            stroke-width: 3;
            color: #FFFACD;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* [â–¼ ì¶”ê°€] ë„¤ì˜¨ í…ìŠ¤íŠ¸ ë°œê´‘ íš¨ê³¼ CSS */
        @keyframes textGlowBlue {

            0%,
            100% {
                text-shadow: 0 0 10px rgba(0, 255, 255, 0.5), 0 0 20px rgba(0, 255, 255, 0.3);
                color: #00FFFF;
            }

            50% {
                text-shadow: 0 0 20px rgba(0, 255, 255, 0.8), 0 0 40px rgba(0, 255, 255, 0.6);
                color: #E0FFFF;
            }
        }

        .animate-text-glow {
            animation: textGlowBlue 2.5s infinite ease-in-out alternate;
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col selection:bg-rpg-accent selection:text-black">

    <header
        class="fixed top-0 left-0 w-full h-20 bg-rpg-900/90 backdrop-blur-md border-b border-rpg-700 z-50 px-8 flex items-center justify-between">
        <div class="flex items-center gap-3 cursor-pointer" onclick="location.href='/'">
            <div class="w-10 h-10 bg-rpg-accent rounded flex items-center justify-center shadow-[0_0_15px_#38bdf8]">
                <i data-lucide="sword" class="text-black w-6 h-6 fill-current"></i>
            </div>
            <span
                class="font-title text-2xl font-black text-white tracking-widest hover:text-rpg-accent transition-colors">TRPG.OS</span>
        </div>

        <div class="flex items-center gap-5">

            <div
                class="hidden md:flex items-center bg-rpg-800 border border-rpg-700 rounded-full px-4 py-1.5 focus-within:border-rpg-accent transition-colors group shadow-inner">
                <input type="text" id="search-input" name="search" onkeyup="if(event.key === 'Enter') performSearch()"
                    placeholder="Search scenarios..."
                    class="bg-transparent border-none text-sm text-gray-300 focus:outline-none w-48 placeholder-gray-600 transition-all focus:w-64 focus:bg-rpg-800 focus:text-white">
                <button onclick="performSearch()" class="ml-2 text-gray-500 group-hover:text-white transition-colors"
                    title="ê²€ìƒ‰">
                    <i data-lucide="search" class="w-4 h-4"></i>
                </button>
            </div>

            <div class="h-6 w-px bg-rpg-700 hidden md:block"></div>

            <button onclick="toggleChatbot()"
                    class="text-gray-400 hover:text-rpg-accent transition-colors p-2 rounded-full hover:bg-white/5 relative group"
                    title="AI ê°€ì´ë“œ">
                <i data-lucide="help-circle" class="w-6 h-6 transition-transform group-hover:rotate-12"></i>
                <span class="absolute top-1 right-1 w-2 h-2 bg-rpg-accent rounded-full animate-ping"></span>
            </button>

            <button onclick="openModal('likes-modal'); htmx.trigger('#liked-grid', 'load');"
                class="text-gray-400 hover:text-red-500 transition-colors p-2 rounded-full hover:bg-white/5 relative group"
                title="ì°œí•œ ëª©ë¡">
                <i data-lucide="heart" class="w-6 h-6 transition-transform group-hover:scale-110"></i>
            </button>

            <div hx-get="/api/views/header-profile" hx-trigger="load from:body" hx-swap="innerHTML">
                <div class="w-10 h-10 rounded-full bg-rpg-800 animate-pulse"></div>
            </div>

        </div>
    </header>

    <main class="flex-1 mt-20 pb-20">

        <div class="container mx-auto px-8 mt-8">
            <div
                class="relative w-full h-[400px] md:h-[500px] overflow-hidden group border border-rpg-700 bg-black rounded-2xl shadow-2xl">

                <div
                    class="absolute inset-0 bg-gradient-to-t from-rpg-900 via-rpg-900/40 to-transparent z-20 pointer-events-none">
                </div>

                <div class="flex w-[200%] h-full animate-slide-infinite will-change-transform">

                    <div class="w-1/5 h-full relative flex-shrink-0">
                        <img src="https://images.unsplash.com/photo-1555680202-c86f0e12f086?q=80&w=1600" class="w-full h-full object-cover" alt="RPG 1">
                    </div>
                    <div class="w-1/5 h-full relative flex-shrink-0">
                        <img src="https://images.unsplash.com/photo-1511512578047-dfb367046420?q=80&w=1600" class="w-full h-full object-cover" alt="RPG 2">
                    </div>
                    <div class="w-1/5 h-full relative flex-shrink-0">
                        <img src="https://images.unsplash.com/photo-1504333638930-c8787321eee0?q=80&w=1600" class="w-full h-full object-cover" alt="RPG 3">
                    </div>
                    <div class="w-1/5 h-full relative flex-shrink-0">
                        <img src="https://images.unsplash.com/photo-1519074069444-1ba4fff66d16?q=80&w=1600" class="w-full h-full object-cover" alt="RPG 4">
                    </div>
                    <div class="w-1/5 h-full relative flex-shrink-0">
                        <img src="https://images.unsplash.com/photo-1550745165-9bc0b252726f?q=80&w=1600" class="w-full h-full object-cover" alt="RPG 5">
                    </div>

                    <div class="w-1/5 h-full relative flex-shrink-0">
                        <img src="https://images.unsplash.com/photo-1555680202-c86f0e12f086?q=80&w=1600" class="w-full h-full object-cover" alt="RPG 1 Clone">
                    </div>
                    <div class="w-1/5 h-full relative flex-shrink-0">
                        <img src="https://images.unsplash.com/photo-1511512578047-dfb367046420?q=80&w=1600" class="w-full h-full object-cover" alt="RPG 2 Clone">
                    </div>
                    <div class="w-1/5 h-full relative flex-shrink-0">
                        <img src="https://images.unsplash.com/photo-1504333638930-c8787321eee0?q=80&w=1600" class="w-full h-full object-cover" alt="RPG 3 Clone">
                    </div>
                    <div class="w-1/5 h-full relative flex-shrink-0">
                        <img src="https://images.unsplash.com/photo-1519074069444-1ba4fff66d16?q=80&w=1600" class="w-full h-full object-cover" alt="RPG 4 Clone">
                    </div>
                    <div class="w-1/5 h-full relative flex-shrink-0">
                        <img src="https://images.unsplash.com/photo-1550745165-9bc0b252726f?q=80&w=1600" class="w-full h-full object-cover" alt="RPG 5 Clone">
                    </div>

                </div>

                ```

**í•µì‹¬ì€ CSSì˜ `translateX(-50%)`ì…ë‹ˆë‹¤.** ì´ ê°’ì„ ìˆ˜ì •í•˜ë©´ 10ê°œì˜ ì´ë¯¸ì§€ ì¤‘ ì ˆë°˜(5ê°œ)ì´ ì§€ë‚˜ê°”ì„ ë•Œ(ì¦‰, ë³µì œë³¸ì˜ ì‹œì‘ì ì¸ 1ë²ˆ ì´ë¯¸ì§€ê°€ í™”ë©´ì— ê½‰ ì°¼ì„ ë•Œ) ì• ë‹ˆë©”ì´ì…˜ì´ `0%` ìœ„ì¹˜(ì›ë³¸ 1ë²ˆ ì´ë¯¸ì§€)ë¡œ ì´ˆê¸°í™”ë˜ë©´ì„œ, ì‚¬ìš©ì ëˆˆì—ëŠ” ëŠê¹€ ì—†ì´ ê³„ì† í˜ëŸ¬ê°€ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ ë©ë‹ˆë‹¤.

                <div class="absolute bottom-0 left-0 w-full p-10 md:p-16 z-30">
                    <div class="max-w-4xl animate-float">
                        <div
                            class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-rpg-accent/10 border border-rpg-accent/20 text-rpg-accent text-xs font-bold mb-6 backdrop-blur-md">
                            <span class="relative flex h-2.5 w-2.5">
                                <span
                                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-rpg-accent opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-rpg-accent"></span>
                            </span>
                            AI Powered TRPG Platform
                        </div>

                        <h1
                            class="text-4xl md:text-6xl font-title font-black text-rpg-accent mb-6 tracking-wide leading-tight drop-shadow-2xl animate-text-glow">
                            DIVE INTO<br>
                            THE ABYSS
                        </h1>

                        <p
                            class="text-gray-300 text-lg md:text-xl font-semibold max-w-2xl leading-relaxed mb-10 opacity-90 drop-shadow-md">
                            ìƒìƒì„ ì´ˆì›”í•˜ëŠ” ëª¨í—˜ì´ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.<br>AIì™€ í•¨ê»˜ ë¬´í•œí•œ ì„¸ê³„ë¥¼ íƒí—˜í•˜ê³  ë‚˜ë§Œì˜ ì´ì•¼ê¸°ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.
                        </p>

                        <div class="flex flex-wrap gap-4">
                            <button id="hero-create-btn" onclick="checkLoginAndRedirect('/views/builder')"
                                class="px-8 py-4 bg-white text-black font-bold rounded-xl hover:bg-rpg-accent transition-all shadow-[0_0_20px_rgba(255,255,255,0.3)] hover:shadow-[0_0_30px_rgba(0,255,255,0.6)] flex items-center gap-2 hover:-translate-y-1">
                                <i data-lucide="sparkles" class="w-5 h-5 text-black"></i> Start Creation
                            </button>

                            <button onclick="document.querySelector('.space-y-16').scrollIntoView({behavior: 'smooth'})"
                                class="px-8 py-4 bg-rpg-800/50 backdrop-blur text-white font-bold rounded-xl hover:bg-white/10 transition-all border border-white/20 hover:border-white/40 flex items-center gap-2 hover:-translate-y-1">
                                Explore <i data-lucide="arrow-down" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="container mx-auto px-8 mt-12">
            <div class="flex flex-col md:flex-row justify-between items-end gap-4 mb-4">

                <div>
                    <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <i data-lucide="filter" class="w-5 h-5 text-rpg-accent"></i> GENRE
                    </h2>
                    <div class="flex flex-wrap gap-3">
                        <button onclick="filterGenre('all')"
                            class="px-4 py-2 rounded-full bg-rpg-accent text-black font-bold text-sm hover:opacity-80 transition-all shadow-[0_0_10px_rgba(56,189,248,0.3)]">ì „ì²´</button>
                        <button onclick="filterGenre('fantasy')"
                            class="px-4 py-2 rounded-full bg-rpg-800 border border-rpg-700 hover:border-rpg-accent text-gray-300 hover:text-white text-sm transition-all">SF/íŒíƒ€ì§€</button>
                        <button onclick="filterGenre('thriller')"
                            class="px-4 py-2 rounded-full bg-rpg-800 border border-rpg-700 hover:border-rpg-accent text-gray-300 hover:text-white text-sm transition-all">ìŠ¤ë¦´ëŸ¬</button>
                        <button onclick="filterGenre('mystery')"
                            class="px-4 py-2 rounded-full bg-rpg-800 border border-rpg-700 hover:border-rpg-accent text-gray-300 hover:text-white text-sm transition-all">ì¶”ë¦¬</button>
                        <button onclick="filterGenre('romance')"
                            class="px-4 py-2 rounded-full bg-rpg-800 border border-rpg-700 hover:border-rpg-accent text-gray-300 hover:text-white text-sm transition-all">ë¡œë§¨ìŠ¤</button>
                        <button onclick="filterGenre('etc')"
                            class="px-4 py-2 rounded-full bg-rpg-800 border border-rpg-700 hover:border-rpg-accent text-gray-300 hover:text-white text-sm transition-all">ê¸°íƒ€</button>
                    </div>
                </div>

            </div>
        </div>

        <div class="space-y-16 mt-12 pb-20">

            <section class="container mx-auto pl-8 pr-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-title font-bold text-white flex items-center gap-2">
                        <span class="w-1 h-6 bg-purple-500 rounded-full shadow-[0_0_10px_#a855f7]"></span> ì¶”ì²œ ì‹œë‚˜ë¦¬ì˜¤
                    </h2>
                    <span class="text-xs text-gray-500">Drag to scroll <i data-lucide="arrow-right"
                            class="inline w-3 h-3"></i></span>
                </div>
                <div class="relative group">
                    <button onclick="scrollListByArrows('recommended-grid', -1)"
                        class="absolute -left-6 top-1/2 -translate-y-1/2 z-20 w-12 h-12 rounded-full border-2 border-gray-600 bg-black/50 backdrop-blur-sm text-gray-400 hover:text-white hover:border-white transition-all flex items-center justify-center opacity-0 group-hover:opacity-100 duration-300 hover:scale-110 shadow-lg">
                        <i data-lucide="chevron-left" class="w-8 h-8"></i>
                    </button>

                    <div id="recommended-grid" class="horizontal-scroll-container flex no-scrollbar"
                        hx-get="/api/scenarios?filter=recommended&limit=10" hx-include="#search-input"
                        hx-trigger="load, new_search from:body">
                        <div
                            class="bg-rpg-800 border border-rpg-700 rounded-xl min-w-[16rem] h-[20rem] animate-pulse flex-shrink-0">
                        </div>
                    </div>

                    <button onclick="scrollListByArrows('recommended-grid', 1)"
                        class="absolute -right-6 top-1/2 -translate-y-1/2 z-20 w-12 h-12 rounded-full border-2 border-gray-600 bg-black/50 backdrop-blur-sm text-gray-400 hover:text-white hover:border-white transition-all flex items-center justify-center opacity-0 group-hover:opacity-100 duration-300 hover:scale-110 shadow-lg">
                        <i data-lucide="chevron-right" class="w-8 h-8"></i>
                    </button>
                </div>
            </section>

            <section class="container mx-auto pl-8 pr-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-title font-bold text-white flex items-center gap-2">
                        <span class="w-1 h-6 bg-rpg-accent rounded-full shadow-[0_0_10px_#38bdf8]"></span> ì‹¤ì‹œê°„ (Newest)
                    </h2>
                    <span class="text-xs text-gray-500">Drag to scroll <i data-lucide="arrow-right"
                            class="inline w-3 h-3"></i></span>
                </div>
                <div class="relative group">
                    <button onclick="scrollListByArrows('realtime-grid', -1)"
                        class="absolute -left-6 top-1/2 -translate-y-1/2 z-20 w-12 h-12 rounded-full border-2 border-gray-600 bg-black/50 backdrop-blur-sm text-gray-400 hover:text-white hover:border-white transition-all flex items-center justify-center opacity-0 group-hover:opacity-100 duration-300 hover:scale-110 shadow-lg">
                        <i data-lucide="chevron-left" class="w-8 h-8"></i>
                    </button>

                    <div id="realtime-grid" class="horizontal-scroll-container flex no-scrollbar"
                        hx-get="/api/scenarios?sort=newest&limit=10&filter=all" hx-include="#search-input"
                        hx-trigger="load, new_search from:body">
                        <div
                            class="bg-rpg-800 border border-rpg-700 rounded-xl min-w-[16rem] h-[20rem] animate-pulse flex-shrink-0">
                        </div>
                    </div>

                    <button onclick="scrollListByArrows('realtime-grid', 1)"
                        class="absolute -right-6 top-1/2 -translate-y-1/2 z-20 w-12 h-12 rounded-full border-2 border-gray-600 bg-black/50 backdrop-blur-sm text-gray-400 hover:text-white hover:border-white transition-all flex items-center justify-center opacity-0 group-hover:opacity-100 duration-300 hover:scale-110 shadow-lg">
                        <i data-lucide="chevron-right" class="w-8 h-8"></i>
                    </button>
                </div>
            </section>

            <section class="container mx-auto pl-8 pr-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-title font-bold text-white flex items-center gap-2">
                        <span class="w-1 h-6 bg-yellow-500 rounded-full shadow-[0_0_10px_#eab308]"></span> ì¸ê¸° (Popular)
                    </h2>
                    <span class="text-xs text-gray-500">Drag to scroll <i data-lucide="arrow-right"
                            class="inline w-3 h-3"></i></span>
                </div>
                <div class="relative group">
                    <button onclick="scrollListByArrows('popular-grid', -1)"
                        class="absolute -left-6 top-1/2 -translate-y-1/2 z-20 w-12 h-12 rounded-full border-2 border-gray-600 bg-black/50 backdrop-blur-sm text-gray-400 hover:text-white hover:border-white transition-all flex items-center justify-center opacity-0 group-hover:opacity-100 duration-300 hover:scale-110 shadow-lg">
                        <i data-lucide="chevron-left" class="w-8 h-8"></i>
                    </button>

                    <div id="popular-grid" class="horizontal-scroll-container flex no-scrollbar"
                        hx-get="/api/scenarios?sort=popular&limit=10&filter=all" hx-include="#search-input"
                        hx-trigger="load, new_search from:body">
                        <div
                            class="bg-rpg-800 border border-rpg-700 rounded-xl min-w-[16rem] h-[20rem] animate-pulse flex-shrink-0">
                        </div>
                    </div>

                    <button onclick="scrollListByArrows('popular-grid', 1)"
                        class="absolute -right-6 top-1/2 -translate-y-1/2 z-20 w-12 h-12 rounded-full border-2 border-gray-600 bg-black/50 backdrop-blur-sm text-gray-400 hover:text-white hover:border-white transition-all flex items-center justify-center opacity-0 group-hover:opacity-100 duration-300 hover:scale-110 shadow-lg">
                        <i data-lucide="chevron-right" class="w-8 h-8"></i>
                    </button>
                </div>
            </section>

            <section class="container mx-auto pl-8 pr-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-title font-bold text-white flex items-center gap-2">
                        <span class="w-1 h-6 bg-green-500 rounded-full shadow-[0_0_10px_#22c55e]"></span> ìŠ¤í…Œë””ì…€ëŸ¬
                    </h2>
                    <span class="text-xs text-gray-500">Drag to scroll <i data-lucide="arrow-right"
                            class="inline w-3 h-3"></i></span>
                </div>
                <div class="relative group">
                    <button onclick="scrollListByArrows('steady-grid', -1)"
                        class="absolute -left-6 top-1/2 -translate-y-1/2 z-20 w-12 h-12 rounded-full border-2 border-gray-600 bg-black/50 backdrop-blur-sm text-gray-400 hover:text-white hover:border-white transition-all flex items-center justify-center opacity-0 group-hover:opacity-100 duration-300 hover:scale-110 shadow-lg">
                        <i data-lucide="chevron-left" class="w-8 h-8"></i>
                    </button>

                    <div id="steady-grid" class="horizontal-scroll-container flex no-scrollbar"
                        hx-get="/api/scenarios?sort=steady&limit=10&filter=all" hx-include="#search-input"
                        hx-trigger="load, new_search from:body">
                        <div
                            class="bg-rpg-800 border border-rpg-700 rounded-xl min-w-[16rem] h-[20rem] animate-pulse flex-shrink-0">
                        </div>
                    </div>

                    <button onclick="scrollListByArrows('steady-grid', 1)"
                        class="absolute -right-6 top-1/2 -translate-y-1/2 z-20 w-12 h-12 rounded-full border-2 border-gray-600 bg-black/50 backdrop-blur-sm text-gray-400 hover:text-white hover:border-white transition-all flex items-center justify-center opacity-0 group-hover:opacity-100 duration-300 hover:scale-110 shadow-lg">
                        <i data-lucide="chevron-right" class="w-8 h-8"></i>
                    </button>
                </div>
            </section>

        </div>
        <footer class="border-t border-rpg-700 mt-20 bg-[#020617] relative z-10 w-full">
            <div class="max-w-[1800px] mx-auto px-12 py-16">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">

                    <div class="col-span-1">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-8 h-8 bg-rpg-700 rounded flex items-center justify-center">
                                <i data-lucide="sword" class="text-gray-400 w-4 h-4 fill-current"></i>
                            </div>
                            <span class="font-title text-lg font-bold text-gray-200 tracking-widest">TRPG.OS</span>
                        </div>
                        <p class="text-xs text-gray-500 leading-relaxed mb-6">
                            Imagination into Reality.<br>
                            ë‚˜ë§Œì˜ ì„¸ê³„ë¥¼ ì°½ì¡°í•˜ê³  ê³µìœ í•˜ì„¸ìš”.
                        </p>
                        <div class="flex gap-4">
                            <a href="https://github.com/Cathesth/TRPG" target="_blank"
                                class="text-gray-500 hover:text-white transition-colors flex items-center gap-2">
                                <i data-lucide="github" class="w-5 h-5"></i>
                                <span class="text-xs">v{{ version }}</span>
                            </a>
                        </div>
                    </div>

                    <div class="col-span-1 md:col-span-2">
                        <h4 class="text-sm font-bold text-gray-300 mb-6 flex items-center gap-2">
                            <i data-lucide="building-2" class="w-4 h-4 text-rpg-accent"></i> COMPANY INFO
                        </h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-xs text-gray-500">
                            <div>
                                <p class="mb-2"><span class="font-bold text-gray-400">ìƒí˜¸ëª…:</span> TRPG Studio Team</p>
                                <p class="mb-2"><span class="font-bold text-gray-400">ëŒ€í‘œì:</span> ê¹€ê°œë°œ</p>
                                <p class="mb-2"><span class="font-bold text-gray-400">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸:</span> 123-45-67890</p>
                            </div>
                            <div>
                                <p class="mb-2"><span class="font-bold text-gray-400">ì£¼ì†Œ:</span> ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 000, 10ì¸µ
                                </p>
                                <p class="mb-2"><span class="font-bold text-gray-400">Contact:</span> help@trpg.os</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-span-1">
                        <h4 class="text-sm font-bold text-gray-300 mb-6 flex items-center gap-2">
                            <i data-lucide="cpu" class="w-4 h-4 text-rpg-accent"></i> POWERED BY
                        </h4>
                        <ul class="text-xs text-gray-500 space-y-3">
                            <li class="flex items-center justify-between border-b border-white/5 pb-2">
                                <span>Core Framework</span>
                                <span class="text-gray-400 font-mono">FastAPI</span>
                            </li>
                            <li class="flex items-center justify-between border-b border-white/5 pb-2">
                                <span>Frontend</span>
                                <span class="text-gray-400 font-mono">HTMX + Tailwind</span>
                            </li>
                            <li class="flex items-center justify-between border-b border-white/5 pb-2">
                                <span>Generative AI</span>
                                <span class="text-rpg-accent font-bold">GPT-4o / DeepSeek</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="border-t border-rpg-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                    <p class="text-[10px] text-gray-600">Â© 2026 TRPG Studio. All rights reserved.</p>
                    <div class="flex gap-6 text-[10px] text-gray-500 font-bold">
                        <a href="#" class="hover:text-white transition-colors">ì´ìš©ì•½ê´€</a>
                        <a href="#" class="hover:text-white transition-colors">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                    </div>
                </div>
            </div>
        </footer>
    </main>

    <div id="likes-modal"
        class="modal opacity-0 pointer-events-none fixed inset-0 z-[100] flex items-center justify-center">
        <div class="modal-overlay absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeModal('likes-modal')">
        </div>
        <div
            class="modal-container bg-rpg-900 w-full max-w-5xl h-[80vh] mx-4 rounded-2xl border border-rpg-700 shadow-2xl transform scale-95 opacity-0 transition-all duration-300 relative z-10 flex flex-col">
            <div class="p-6 border-b border-rpg-700 flex justify-between items-center bg-rpg-800 rounded-t-2xl">
                <h3 class="text-2xl font-title font-bold text-white flex items-center gap-2">
                    <i data-lucide="heart" class="w-6 h-6 text-red-500 fill-red-500"></i> Liked Scenarios
                </h3>
                <button onclick="closeModal('likes-modal')" class="text-gray-400 hover:text-white"><i data-lucide="x"
                        class="w-6 h-6"></i></button>
            </div>
            <div class="p-8 overflow-y-auto flex-1 custom-scrollbar">
                <div id="liked-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                    hx-get="/api/scenarios?filter=liked" hx-trigger="load, refresh_likes from:body">
                    <div class="col-span-full flex justify-center py-10">
                        <i data-lucide="loader-2" class="w-8 h-8 animate-spin text-rpg-accent"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="login-modal"
        class="modal opacity-0 pointer-events-none fixed inset-0 z-[100] flex items-center justify-center">
        <div class="modal-overlay absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeModal('login-modal')">
        </div>
        <div
            class="modal-container bg-rpg-800 w-full max-w-md mx-4 rounded-2xl border border-rpg-700 shadow-2xl transform scale-95 opacity-0 transition-all duration-300 relative z-10">
            <div class="p-8">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-2xl font-title font-bold text-white">LOGIN</h3>
                    <button onclick="closeModal('login-modal')" class="text-gray-400 hover:text-white"><i
                            data-lucide="x" class="w-6 h-6"></i></button>
                </div>
                <form onsubmit="handleLogin(event)" class="space-y-6">
                    <div>
                        <label class="block text-gray-400 text-xs font-bold mb-2">USERNAME</label>
                        <input type="text" name="username" required
                            class="w-full bg-rpg-900 border border-rpg-700 rounded-lg p-3 text-white focus:border-rpg-accent focus:outline-none transition-colors">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-xs font-bold mb-2">PASSWORD</label>
                        <input type="password" name="password" required
                            class="w-full bg-rpg-900 border border-rpg-700 rounded-lg p-3 text-white focus:border-rpg-accent focus:outline-none transition-colors">
                    </div>
                    <div id="login-error" class="text-red-400 text-xs hidden"></div>
                    <button type="submit"
                        class="w-full bg-rpg-accent hover:bg-white text-black font-bold py-4 rounded-lg shadow-lg transition-all">ACCESS
                        SYSTEM</button>
                </form>

                <div class="mt-6 pt-6 border-t border-rpg-700">
                    <p class="text-xs text-gray-500 text-center mb-3">ê°„í¸ ë¡œê·¸ì¸ / íšŒì›ê°€ì…</p>
                    <div class="flex flex-col gap-2">
                        <a href="/api/auth/login/google"
                            class="flex items-center justify-center gap-3 w-full py-3 bg-white text-gray-800 font-bold rounded-lg hover:bg-gray-100 transition-colors">
                            <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5" alt="G">
                            <span>Googleë¡œ ê³„ì†í•˜ê¸°</span>
                        </a>

                        <a href="/api/auth/login/naver"
                            class="flex items-center justify-center gap-3 w-full py-3 bg-[#03C75A] text-white font-bold rounded-lg hover:opacity-90 transition-opacity">
                            <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24">
                                <path d="M16.273 12.845L7.376 0H0v24h7.726V11.156L16.624 24H24V0h-7.727v12.845z" />
                            </svg>
                            <span>Naverë¡œ ê³„ì†í•˜ê¸°</span>
                        </a>

                        <a href="/api/auth/login/kakao"
                            class="flex items-center justify-center gap-3 w-full py-3 bg-[#FEE500] text-[#191919] font-bold rounded-lg hover:opacity-90 transition-opacity">
                            <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24">
                                <path
                                    d="M12 3c-4.97 0-9 3.185-9 7.115 0 2.557 1.707 4.8 4.27 6.054-.188.702-.682 2.545-.78 2.94-.122.49.178.483.376.351.155-.103 2.466-1.675 3.464-2.353.541.08 1.1.123 1.67.123 4.97 0 9-3.185 9-7.115S16.97 3 12 3z" />
                            </svg>
                            <span>Kakaoë¡œ ê³„ì†í•˜ê¸°</span>
                        </a>
                    </div>
                </div>
                <div class="mt-6 text-center text-sm text-gray-500">
                    ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <button onclick="closeModal('login-modal'); openModal('register-modal')"
                        class="text-rpg-accent hover:underline font-bold ml-1">íšŒì›ê°€ì… í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <div id="register-modal"
        class="modal opacity-0 pointer-events-none fixed inset-0 z-[100] flex items-center justify-center">
        <div class="modal-overlay absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeModal('register-modal')">
        </div>
        <div
            class="modal-container bg-rpg-800 w-full max-w-md mx-4 rounded-2xl border border-rpg-700 shadow-2xl transform scale-95 opacity-0 transition-all duration-300 relative z-10">
            <div class="p-8">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-2xl font-title font-bold text-white">REGISTER</h3>
                    <button onclick="closeModal('register-modal')" class="text-gray-400 hover:text-white"><i
                            data-lucide="x" class="w-6 h-6"></i></button>
                </div>
                <form onsubmit="handleRegister(event)" class="space-y-4">
                    <div>
                        <label class="block text-gray-400 text-xs font-bold mb-1">USERNAME</label>
                        <input type="text" name="username" required
                            class="w-full bg-rpg-900 border border-rpg-700 rounded-lg p-3 text-white focus:border-rpg-accent focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-xs font-bold mb-1">EMAIL</label>
                        <input type="email" name="email" required
                            class="w-full bg-rpg-900 border border-rpg-700 rounded-lg p-3 text-white focus:border-rpg-accent focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-xs font-bold mb-1">PASSWORD</label>
                        <input type="password" name="password" required
                            class="w-full bg-rpg-900 border border-rpg-700 rounded-lg p-3 text-white focus:border-rpg-accent focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-xs font-bold mb-1">CONFIRM PASSWORD</label>
                        <input type="password" name="confirm_password" required
                            class="w-full bg-rpg-900 border border-rpg-700 rounded-lg p-3 text-white focus:border-rpg-accent focus:outline-none">
                    </div>
                    <div id="register-error" class="text-red-400 text-xs hidden"></div>
                    <button type="submit"
                        class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-lg shadow-lg mt-2 transition-all">CREATE
                        ACCOUNT</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        document.body.addEventListener('htmx:afterSwap', function (evt) {
            lucide.createIcons();
            enableHorizontalScroll();
        });

        // [ìˆ˜ì •] ë“œë˜ê·¸ ìŠ¤í¬ë¡¤ ë¡œì§ ê°œì„  (í´ë¦­í•œ ìƒíƒœì—ì„œë§Œ ì´ë™)
        function enableHorizontalScroll() {
            const containers = document.querySelectorAll('.horizontal-scroll-container');
            containers.forEach(slider => {
                if (slider.dataset.initScroll) return;
                slider.dataset.initScroll = "true";

                // â–¼â–¼â–¼ [ì¶”ê°€] ì´ë¯¸ì§€/í…ìŠ¤íŠ¸ ë“œë˜ê·¸ ë°©ì§€ (ì´ê²Œ ì—†ìœ¼ë©´ íˆ­íˆ­ ëŠê¹€) â–¼â–¼â–¼
                slider.addEventListener('dragstart', (e) => e.preventDefault());
                // â–²â–²â–² [ì¶”ê°€ ì™„ë£Œ] â–²â–²â–²

                let isDown = false;
                let startX;
                let scrollLeft;

                slider.addEventListener('mousedown', (e) => {
                    isDown = true;
                    slider.classList.add('active');
                    startX = e.pageX - slider.offsetLeft;
                    scrollLeft = slider.scrollLeft;
                });

                slider.addEventListener('mouseleave', () => {
                    isDown = false;
                    slider.classList.remove('active');
                });

                slider.addEventListener('mouseup', () => {
                    isDown = false;
                    slider.classList.remove('active');
                });

                slider.addEventListener('mousemove', (e) => {
                    if (!isDown) return;
                    e.preventDefault();
                    const x = e.pageX - slider.offsetLeft;
                    const walk = (x - startX) * 2;
                    slider.scrollLeft = scrollLeft - walk;
                });
            });
        }
        document.addEventListener('DOMContentLoaded', enableHorizontalScroll);

        // [ì¶”ê°€] í™”ì‚´í‘œ ë²„íŠ¼ í´ë¦­ ì‹œ 5ì¹¸ì”© ì´ë™í•˜ëŠ” í•¨ìˆ˜
        function scrollListByArrows(elementId, direction) {
            const container = document.getElementById(elementId);
            if (!container) return;

            // ì¹´ë“œ ë„ˆë¹„(16rem=256px) + ê°„ê²©(1.5rem=24px) = ì•½ 280px
            const unitWidth = 280;
            const scrollAmount = unitWidth * 5 * direction; // 5ì¹¸ ì´ë™

            container.scrollBy({
                left: scrollAmount,
                behavior: 'smooth'
            });
        }

        window.playScenario = async function (filename, btn) {
            // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
            try {
                const userRes = await fetch('/api/user/status');
                const userData = await userRes.json();
                if (!userData.success) {
                    // ë¡œê·¸ì¸ ì•ˆë˜ì–´ ìˆìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                    window.location.href = '/login';
                    return;
                }
            } catch (e) {
                console.error('ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', e);
                window.location.href = '/login';
                return;
            }

            const originalText = btn.innerHTML;
            btn.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Loading...';
            btn.disabled = true;
            lucide.createIcons();
            try {
                const formData = new FormData();
                formData.append('filename', filename);
                const res = await fetch('/api/load_scenario', { method: 'POST', body: formData });
                if (res.ok) {
                    const data = await res.json();

                    // âœ… [FIX] ê¸°ì¡´ ì„¸ì…˜ ë°ì´í„° ì™„ì „íˆ í´ë¦¬ì–´ (ë‚¡ì€ ë°ì´í„° ê°„ì„­ ì°¨ë‹¨)
                    console.log('ğŸ§¹ [LOAD] Clearing old session data...');
                    sessionStorage.clear();

                    // âœ… [ë¦¬ë‹¤ì´ë ‰íŠ¸ ì „ ì €ì¥ ë³´ì¥] session_idë¥¼ ë¨¼ì € ì €ì¥í•˜ê³  ë‚˜ì„œ ì´ë™
                    const sessionId = data.session_id || data.session_key;
                    const scenarioId = data.scenario_id;

                    // 1ë‹¨ê³„: sessionStorageì— ìƒˆ ì„¸ì…˜ ë°ì´í„° ì €ì¥ (ì´ë™ë³´ë‹¤ ë¨¼ì € ì‹¤í–‰)
                    if (sessionId) {
                        sessionStorage.setItem('trpg_session_key', sessionId);
                        console.log('âœ… [LOAD] Session ID saved to storage before redirect:', sessionId);
                    }
                    if (scenarioId) {
                        sessionStorage.setItem('trpg_scenario_id', scenarioId);
                        console.log('âœ… [LOAD] Scenario ID saved:', scenarioId);
                    }

                    // ë¡œë“œ í”Œë˜ê·¸ ì„¤ì •
                    sessionStorage.setItem('trpg_scenario_loaded', 'true');

                    // 2ë‹¨ê³„: ì €ì¥ ì™„ë£Œ í›„ URL íŒŒë¼ë¯¸í„°ì— session_idì™€ scenario_idë¥¼ í¬í•¨í•˜ì—¬ ë¦¬ë‹¤ì´ë ‰íŠ¸
                    // [TUTORIAL] í”Œë ˆì´ ë²„íŠ¼ í´ë¦­ ì‹œ 'start_tutorial=true' íŒŒë¼ë¯¸í„° ì¶”ê°€
                    if (sessionId && scenarioId) {
                        console.log('ğŸš€ [LOAD] Redirecting to player view with session_id:', sessionId, 'scenario_id:', scenarioId);
                        window.location.href = `/views/player?session_id=${sessionId}&scenario_id=${scenarioId}&start_tutorial=true`;
                    } else if (sessionId) {
                        // scenario_idê°€ ì—†ëŠ” ê²½ìš° (í•˜ìœ„ í˜¸í™˜ì„±)
                        console.warn('âš ï¸ [LOAD] No scenario_id received, redirecting with session_id only');
                        window.location.href = `/views/player?session_id=${sessionId}&start_tutorial=true`;
                    } else {
                        // session_idê°€ ì—†ëŠ” ê²½ìš° í´ë°±
                        console.warn('âš ï¸ [LOAD] No session_id received, redirecting without parameter');
                        window.location.href = '/views/player?start_tutorial=true';
                    }
                } else {
                    alert('ë¡œë“œ ì‹¤íŒ¨: ' + await res.text());
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            } catch (e) { console.error(e); btn.innerHTML = originalText; btn.disabled = false; }
        };

        window.deleteScenario = async function (filename, btn) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            try {
                const res = await fetch('/api/delete_scenario', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ filename: filename })
                });
                const data = await res.json();
                if (data.success) {
                    const card = btn.closest('.scenario-card-base');
                    if (card) {
                        card.style.opacity = '0';
                        setTimeout(() => card.remove(), 300);
                    } else window.location.reload();
                } else alert('ì‚­ì œ ì‹¤íŒ¨: ' + data.error);
            } catch (e) { alert('ì˜¤ë¥˜'); }
        };

        window.editScenario = function (filename) {
            window.location.href = `/views/builder?scenario=${encodeURIComponent(filename)}`;
        };

        // ë¡œê·¸ì¸ ì²´í¬ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ëŠ” ëª¨ë‹¬ í‘œì‹œ
        window.checkLoginAndRedirect = async function (targetUrl) {
            try {
                const res = await fetch('/api/user/status');
                const data = await res.json();
                if (data.success && data.username) {
                    // ë¡œê·¸ì¸ ìƒíƒœ: í˜ì´ì§€ ì´ë™
                    window.location.href = targetUrl;
                } else {
                    // ë¹„ë¡œê·¸ì¸ ìƒíƒœ: ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
                    openModal('login-modal');
                }
            } catch (e) {
                // ì˜¤ë¥˜ ì‹œ ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
                openModal('login-modal');
            }
        };

        window.openModal = function (id) {
            const modal = document.getElementById(id);
            modal.classList.remove('opacity-0', 'pointer-events-none');
            document.body.classList.add('modal-active');
            setTimeout(() => {
                modal.querySelector('.modal-container').classList.remove('scale-95', 'opacity-0');
                modal.querySelector('.modal-container').classList.add('scale-100', 'opacity-100');
            }, 10);
        };

        window.closeModal = function (id) {
            const modal = document.getElementById(id);
            modal.querySelector('.modal-container').classList.remove('scale-100', 'opacity-100');
            modal.querySelector('.modal-container').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('opacity-0', 'pointer-events-none');
                document.body.classList.remove('modal-active');
            }, 300);
        };

        window.handleLogin = async function (e) {
            e.preventDefault(); const form = e.target;
            try {
                const res = await fetch('/api/auth/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: form.username.value, password: form.password.value }) });
                const data = await res.json();
                if (data.success) {
                    // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ show_login íŒŒë¼ë¯¸í„° ì œê±°í•˜ê³  ë¦¬ë¡œë“œ
                    const url = new URL(window.location);
                    url.searchParams.delete('show_login');

                    // í˜„ì¬ í˜ì´ì§€ê°€ /loginì´ë©´ ë©”ì¸ìœ¼ë¡œ, ì•„ë‹ˆë©´ í˜„ì¬ í˜ì´ì§€ ë¦¬ë¡œë“œ
                    if (window.location.pathname === '/login') {
                        window.location.href = '/';
                    } else {
                        window.location.href = url.toString();
                    }
                } else {
                    alert(data.error);
                }
            } catch (e) { alert("í†µì‹  ì˜¤ë¥˜"); }
        };

        window.handleRegister = async function (e) {
            e.preventDefault(); const form = e.target;
            if (form.password.value !== form.confirm_password.value) return alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜");
            try {
                const res = await fetch('/api/auth/register', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: form.username.value, password: form.password.value, email: form.email.value }) });
                const data = await res.json();
                if (data.success) { alert("ê°€ì… ì„±ê³µ!"); closeModal('register-modal'); openModal('login-modal'); }
                else alert(data.error);
            } catch (e) { alert("í†µì‹  ì˜¤ë¥˜"); }
        };

        function filterGenre(genre) {
            alert("ì¥ë¥´ í•„í„°: " + genre + " (ê¸°ëŠ¥ ì¤€ë¹„ì¤‘)");
        }

        // â–¼ [ì¶”ê°€] ê²€ìƒ‰ ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸
        function performSearch() {
            //const query = document.getElementById('search-input').value;
            //// ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë°˜ì˜í•  ëª©ë¡ë“¤ (ì‹¤ì‹œê°„, ì¸ê¸°, ìŠ¤í…Œë””ì…€ëŸ¬)
            //const targetGrids = ['realtime-grid', 'popular-grid', 'steady-grid'];

            //targetGrids.forEach(gridId => {
            //const element = document.getElementById(gridId);
            //if (element) {
            //// ê¸°ì¡´ API URLì„ ê°€ì ¸ì™€ì„œ ê²€ìƒ‰ì–´ íŒŒë¼ë¯¸í„°ë§Œ ì¶”ê°€/ê°±ì‹ 
            //let currentUrl = element.getAttribute('hx-get');
            //if (currentUrl.includes('&search=')) {
            //    currentUrl = currentUrl.split('&search=')[0];
            //}

            //let newUrl = currentUrl;
            //if (query.trim() !== "") {
            //    newUrl += `&search=${encodeURIComponent(query)}`;
            //}

            //// hx-get ì†ì„± ì—…ë°ì´íŠ¸ í›„ ë¦¬ë¡œë“œ íŠ¸ë¦¬ê±°
            //element.setAttribute('hx-get', newUrl);
            //htmx.trigger(element, 'refresh_list');
            //}
            //});
            document.body.dispatchEvent(new Event('new_search'));
        }

        // [ìˆ˜ì •] ì°œ í† ê¸€ í•¨ìˆ˜ (ëª¨ë“  ë°°ë„ˆ ë™ê¸°í™” ì ìš©)
        async function toggleLike(scenarioId, btn) {
            try {
                const res = await fetch(`/api/scenarios/${scenarioId}/like`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const data = await res.json();

                if (data.success) {
                    // 1. [ë™ê¸°í™”] í™”ë©´ì— ìˆëŠ” 'ëª¨ë“ ' í•´ë‹¹ ì‹œë‚˜ë¦¬ì˜¤ì˜ ì¢‹ì•„ìš” ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                    // (ì‹¤ì‹œê°„, ì¸ê¸°, ì¶”ì²œ ëª©ë¡ ë“±ì— ê°™ì€ ì¹´ë“œê°€ ì—¬ëŸ¬ ê°œ ìˆì„ ìˆ˜ ìˆìŒ)
                    const allBtns = document.querySelectorAll(`.like-btn-${scenarioId}`);

                    allBtns.forEach(b => {
                        const icon = b.querySelector('svg') || b.querySelector('i');
                        if (data.liked) {
                            // ì°œ ì¼œê¸°
                            icon.classList.add('text-red-500', 'fill-red-500');
                            icon.classList.remove('text-white/70', 'hover:text-red-500');
                        } else {
                            // ì°œ ë„ê¸°
                            icon.classList.remove('text-red-500', 'fill-red-500');
                            icon.classList.add('text-white/70', 'hover:text-red-500');
                        }
                    });

                    // 2. [ë™ê¸°í™”] í™”ë©´ì— ìˆëŠ” 'ëª¨ë“ ' í•´ë‹¹ ì‹œë‚˜ë¦¬ì˜¤ì˜ ì¢‹ì•„ìš” ìˆ«ì ë³€ê²½
                    if (data.count !== undefined) {
                        const allCounts = document.querySelectorAll(`.like-count-${scenarioId}`);
                        allCounts.forEach(span => {
                            span.innerText = data.count;
                        });
                    }

                    // 3. ì°œ ëª©ë¡ ê°±ì‹  ì´ë²¤íŠ¸ ë°œìƒ
                    document.body.dispatchEvent(new Event('refresh_likes'));

                    // (ì˜µì…˜) ì°œ í•´ì œ ì‹œ, 'ì°œí•œ ëª©ë¡ ëª¨ë‹¬' ë‚´ë¶€ì— ìˆëŠ” ì¹´ë“œë¼ë©´ ì œê±°
                    if (!data.liked) {
                        const modalGrid = btn.closest('#liked-grid');
                        if (modalGrid) {
                            const card = btn.closest('.scenario-card-base');
                            card.style.opacity = '0';
                            setTimeout(() => card.remove(), 300);
                        }
                    }

                } else {
                    alert(data.error || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (e) {
                console.error(e);
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•˜ê±°ë‚˜ ì„œë²„ ì˜¤ë¥˜ì…ë‹ˆë‹¤.');
            }
        }
    </script>

    <script src="/static/js/tutorial.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (window.TutorialSystem) {
                // ì¸ë±ìŠ¤ í˜ì´ì§€ íŠœí† ë¦¬ì–¼ ì‹œì‘
                window.TutorialSystem.checkAndStart('index');
            } else {
                console.error('[Index] TutorialSystem not loaded.');
            }
        });
    </script>

    {% if show_login %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            openModal('login-modal');
        });
    </script>
    {% endif %}

        <div id="chatbot-modal" class="fixed bottom-6 right-6 z-[200] w-96 h-[600px] bg-rpg-900 border-2 border-rpg-accent rounded-xl shadow-2xl flex flex-col transform transition-transform duration-300 translate-y-[120%] opacity-0 pointer-events-none origin-bottom-right">
        <div class="p-4 bg-rpg-800 border-b border-rpg-700 flex justify-between items-center rounded-t-xl">
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <h3 class="text-white font-bold font-title text-sm">AI SUPPORT AGENT</h3>
            </div>
            <button onclick="toggleChatbot()" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>

        <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar bg-black/20">
            <div class="flex flex-col gap-2 items-start animate-fade-in">
                <div class="bg-rpg-800 text-gray-200 p-3 rounded-2xl rounded-tl-none border border-rpg-700 text-xs leading-relaxed max-w-[85%]">
                    ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?<br>ì•„ë˜ í‚¤ì›Œë“œë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                </div>
                <div class="flex flex-wrap gap-2">
                    <button onclick="sendChoice('ì‹œë‚˜ë¦¬ì˜¤ ì œì‘ ë°©ë²•')" class="px-3 py-1 bg-rpg-700 hover:bg-rpg-accent hover:text-black border border-rpg-600 rounded-full text-[10px] transition-colors">ì‹œë‚˜ë¦¬ì˜¤ ì œì‘</button>
                    <button onclick="sendChoice('ìš”ê¸ˆì œ ì•ˆë‚´')" class="px-3 py-1 bg-rpg-700 hover:bg-rpg-accent hover:text-black border border-rpg-600 rounded-full text-[10px] transition-colors">ìš”ê¸ˆì œ</button>
                </div>
            </div>
        </div>

        <div class="p-3 bg-rpg-800 border-t border-rpg-700 rounded-b-xl">
            <form onsubmit="handleChatSubmit(event)" class="relative">
                <input type="text" id="chat-input"
                       class="w-full bg-rpg-900 text-white text-sm rounded-lg pl-4 pr-10 py-3 border border-rpg-700 focus:border-rpg-accent focus:outline-none placeholder-gray-600"
                       placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off">
                <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 text-rpg-accent hover:text-white p-1">
                    <i data-lucide="send" class="w-4 h-4"></i>
                </button>
            </form>
        </div>
    </div>

    <script>
        // ì±—ë´‡ í† ê¸€
        function toggleChatbot() {
            const modal = document.getElementById('chatbot-modal');
            if (modal.classList.contains('translate-y-[120%]')) {
                // ì—´ê¸°
                modal.classList.remove('translate-y-[120%]', 'opacity-0', 'pointer-events-none');
                document.getElementById('chat-input').focus();
            } else {
                // ë‹«ê¸°
                modal.classList.add('translate-y-[120%]', 'opacity-0', 'pointer-events-none');
            }
        }

        // ì„ íƒì§€ í´ë¦­
        function sendChoice(text) {
            const input = document.getElementById('chat-input');
            input.value = text; // ì…ë ¥ì°½ì— í…ìŠ¤íŠ¸ ì±„ìš°ê³ 
            handleChatSubmit(new Event('submit')); // ì „ì†¡
        }

        // ë©”ì‹œì§€ ì „ì†¡ í•¸ë“¤ëŸ¬
        async function handleChatSubmit(e) {
            e.preventDefault();
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;

            // â–¼â–¼â–¼ [ì¶”ê°€] "ë¹Œë” ëª¨ë“œ ì´ë™" í‚¤ì›Œë“œ ê°ì§€ ì‹œ í˜ì´ì§€ ì´ë™ ì²˜ë¦¬ â–¼â–¼â–¼
            // 1. ë¹Œë” ëª¨ë“œë¡œ ì´ë™ (í…ìŠ¤íŠ¸ê°€ ì •í™•íˆ ì¼ì¹˜í•˜ê±°ë‚˜ í¬í•¨ë  ê²½ìš°)
            if (text === 'ë¹Œë” ëª¨ë“œ ì´ë™' || text === 'ë¹Œë” ëª¨ë“œ') {
                if (typeof window.checkLoginAndRedirect === 'function') {
                    window.checkLoginAndRedirect('/views/builder');
                } else {
                    window.location.href = '/views/builder';
                }
                input.value = '';
                return; // ì±—ë´‡ ë©”ì‹œì§€ ì „ì†¡ ë§‰ê³  í•¨ìˆ˜ ì¢…ë£Œ
            }

            // 2. ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™ (í…ìŠ¤íŠ¸ê°€ ì •í™•íˆ ì¼ì¹˜í•˜ê±°ë‚˜ í¬í•¨ë  ê²½ìš°)
            if (text === 'ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™' || text === 'ë§ˆì´í˜ì´ì§€') {
                if (typeof window.checkLoginAndRedirect === 'function') {
                    window.checkLoginAndRedirect('/views/mypage');
                } else {
                    window.location.href = '/views/mypage';
                }
                input.value = '';
                return; // ì±—ë´‡ ë©”ì‹œì§€ ì „ì†¡ ë§‰ê³  í•¨ìˆ˜ ì¢…ë£Œ
            }

            await sendMessage(text);
            input.value = '';
        }

        // ë©”ì‹œì§€ ì²˜ë¦¬ ë° API í˜¸ì¶œ
        async function sendMessage(text) {
            const chatBox = document.getElementById('chat-messages');

            // 1. ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
            chatBox.insertAdjacentHTML('beforeend', `
                <div class="flex justify-end animate-fade-in">
                    <div class="bg-rpg-accent text-black p-3 rounded-2xl rounded-tr-none text-xs font-bold max-w-[85%]">
                        ${text}
                    </div>
                </div>
            `);
            chatBox.scrollTop = chatBox.scrollHeight;

            // 2. ë¡œë”© í‘œì‹œ
            const loadingId = 'loading-' + Date.now();
            chatBox.insertAdjacentHTML('beforeend', `
                <div id="${loadingId}" class="flex justify-start animate-fade-in">
                    <div class="bg-rpg-800 text-gray-400 p-3 rounded-2xl rounded-tl-none border border-rpg-700 text-xs">
                        <i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>
                    </div>
                </div>
            `);
            lucide.createIcons();
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                // 3. API í˜¸ì¶œ (ì‹¤ì œ êµ¬í˜„ëœ ì—”ë“œí¬ì¸íŠ¸ë¡œ êµì²´ í•„ìš”)
                const res = await fetch('/api/chatbot/query', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: text })
                });
                const data = await res.json();

                // 4. ë¡œë”© ì œê±°
                const loadingEl = document.getElementById(loadingId);
                if (loadingEl) loadingEl.remove();

                // 5. ë‹µë³€ ë° ì„ íƒì§€ ë Œë”ë§
                let choicesHtml = '';
                if (data.choices && data.choices.length > 0) {
                    choicesHtml = `<div class="flex flex-wrap gap-2 mt-2">
                        ${data.choices.map(c => `<button onclick="sendChoice('${c}')" class="px-3 py-1 bg-rpg-700 hover:bg-rpg-accent hover:text-black border border-rpg-600 rounded-full text-[10px] transition-colors">${c}</button>`).join('')}
                    </div>`;
                }

                chatBox.insertAdjacentHTML('beforeend', `
                    <div class="flex flex-col gap-2 items-start animate-fade-in">
                        <div class="bg-rpg-800 text-gray-200 p-3 rounded-2xl rounded-tl-none border border-rpg-700 text-xs leading-relaxed max-w-[90%]">
                            ${data.answer}
                        </div>
                        ${choicesHtml}
                    </div>
                `);
            } catch (e) {
                const loadingEl = document.getElementById(loadingId);
                if (loadingEl) loadingEl.remove();
                chatBox.insertAdjacentHTML('beforeend', `<div class="text-red-500 text-xs p-2">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${e.message}</div>`);
            }

            lucide.createIcons();
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
    </body>

</html>