<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRPG Studio - My Archives</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* 텍스트 글로우 애니메이션 효과 */
        @keyframes textGlow {
            0%, 100% { text-shadow: 0 0 5px rgba(56, 189, 248, 0.2); }
            50% { text-shadow: 0 0 15px rgba(56, 189, 248, 0.6); color: white; }
        }
        .animate-text-glow:hover {
            animation: textGlow 2s infinite;
        }

        /* 스크롤바 디자인 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #020617;
        }
        ::-webkit-scrollbar-thumb {
            background: #1e293b;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #38bdf8;
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        rpg: {
                            900: '#020617', // 배경색
                            800: '#0f172a', // 카드색
                            700: '#1e293b', // 테두리
                            accent: '#38bdf8', // 포인트 컬러
                            hover: '#0ea5e9',
                            danger: '#ef4444',
                        }
                    },
                    fontFamily: {
                        title: ['Cinzel', 'serif'],
                        body: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-rpg-900 text-gray-200 font-body min-h-screen">
    <div class="max-w-7xl mx-auto px-6 py-12">
        <!-- 프로필 헤더 섹션 -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-8 mb-16 border-b border-rpg-700 pb-12">
            <div class="flex items-center gap-10">
                <!-- 프로필 이미지 -->
                <div class="relative group">
                    <div class="absolute -inset-1 bg-gradient-to-r from-rpg-accent to-purple-600 rounded-2xl blur opacity-25 group-hover:opacity-60 transition duration-1000"></div>
                    <div class="relative w-36 h-36 rounded-2xl border-2 border-rpg-accent/30 p-1 bg-rpg-800">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Operator" class="w-full h-full rounded-xl bg-rpg-900" alt="프로필 이미지">
                    </div>
                </div>

                <!-- 유저 정보 -->
                <div>
                    <h1 class="text-4xl font-black font-title text-white tracking-widest animate-text-glow cursor-default uppercase">
                        OPERATOR <span class="text-rpg-accent">#001</span>
                    </h1>
                    <div class="flex gap-4 mt-4">
                        <span class="px-4 py-1.5 bg-rpg-accent/10 border border-rpg-accent/30 rounded-full text-xs font-bold text-rpg-accent uppercase tracking-tighter">LV. 99 GM</span>
                        <span class="px-4 py-1.5 bg-rpg-800 border border-rpg-700 rounded-full text-xs font-bold text-gray-400 uppercase tracking-tighter">ARCHIVIST</span>
                    </div>
                </div>
            </div>

            <!-- 액션 버튼 영역 -->
            <div class="flex items-center gap-4">
                <a href="/views/builder" class="px-8 py-4 bg-rpg-accent hover:bg-rpg-hover text-rpg-900 rounded-xl font-black transition-all flex items-center gap-3 shadow-lg shadow-rpg-accent/20 transform hover:-translate-y-1">
                    <i data-lucide="plus-circle" class="w-5 h-5"></i>
                    CREATE NEW SCENARIO
                </a>
                <a href="/" class="p-4 bg-rpg-800 hover:bg-rpg-700 border border-rpg-700 rounded-xl transition-all group" title="메인으로">
                    <i data-lucide="home" class="w-6 h-6 group-hover:text-rpg-accent transition-colors"></i>
                </a>
            </div>
        </header>

        <!-- 아카이브 섹션 -->
        <section class="space-y-10">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold font-title flex items-center gap-4 uppercase tracking-[0.2em]">
                    <i data-lucide="library" class="text-rpg-accent w-7 h-7"></i> My Archives
                </h2>
                <div class="h-[1px] flex-1 mx-8 bg-gradient-to-r from-rpg-700 to-transparent opacity-30"></div>
            </div>

            <!-- 시나리오 그리드 (HTMX) -->
            <!-- Invalid URL 에러 해결을 위해 hx-get 경로에서 슬래시(/)를 제거하거나 상대 경로로 지정 -->
            <div id="my-scenario-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"
                 hx-get="/api/scenarios"
                 hx-vals='{"filter": "my"}'
                 hx-trigger="load">

                <!-- 초기 로딩 상태 -->
                <div class="col-span-full py-32 flex flex-col items-center justify-center gap-6 bg-rpg-800/10 border-2 border-dashed border-rpg-700 rounded-[2rem]">
                    <div class="relative">
                        <div class="w-16 h-16 border-4 border-rpg-accent/10 border-t-rpg-accent rounded-full animate-spin"></div>
                        <i data-lucide="database" class="w-6 h-6 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-rpg-accent/30"></i>
                    </div>
                    <p class="text-sm font-bold font-title text-gray-500 tracking-[0.4em] animate-pulse uppercase">Accessing Core Terminal...</p>
                </div>
            </div>
        </section>
    </div>

    <!-- 스크립트 영역 -->
    <script>
        lucide.createIcons();

        // HTMX 전역 설정: Invalid URL 에러 방지를 위한 인터셉터 (선택 사항)
        document.body.addEventListener('htmx:beforeRequest', function(evt) {
            // 요청 경로가 절대 경로(/)로 시작하면 현재 호스트 정보를 붙여줌
            let path = evt.detail.path;
            if (path.startsWith('/')) {
                const baseUrl = window.location.origin;
                if (baseUrl !== 'null' && baseUrl !== 'undefined') {
                    evt.detail.path = baseUrl + path;
                }
            }
        });

        <script>
        // ... 기존 코드 중 window.playScenario 부분 수정 ...
        window.playScenario = async function(fid, btn) {
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i>';
            btn.disabled = true;
            lucide.createIcons();

            try {
                // GET이 아닌 POST로, FormData를 사용하여 전송해야 합니다 (api.py 사양 준수)
                const formData = new FormData();
                formData.append('filename', fid);

                const res = await fetch('/api/load_scenario', {
                 method: 'POST',
                 body: formData
                 });

                if (res.ok) {
                 window.location.href = '/views/player';
                 }else {
                    alert('로드 실패');
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    }
            } catch (e) {
                btn.innerHTML = originalText;
                btn.disabled = false;
               }

        };


        window.editScenario = function(fid) {
            window.location.href = `/views/builder?scenario=${encodeURIComponent(fid)}`;
        };

        window.deleteScenario = async function(fid, btn) {
            if (!confirm('이 시나리오를 영구히 삭제하시겠습니까?')) return;
            try {
                const res = await fetch('/api/delete_scenario', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ filename: fid })
                });
                const data = await res.json();
                if (data.success) {
                    htmx.trigger("#my-scenario-grid", "load");
                } else {
                    alert('삭제 중 오류가 발생했습니다.');
                }
            } catch (e) {
                console.error('Delete Error:', e);
            }
        };

        document.body.addEventListener('htmx:afterOnLoad', function(evt) {
            if (evt.detail.target.id === "my-scenario-grid") {
                lucide.createIcons();
            }
        });

         // HTMX 이벤트 리스너

        document.body.addEventListener('htmx:afterOnLoad', function(evt) {

            if (evt.detail.target.id === "my-scenario-grid") { lucide.createIcons(); }
          });

    </script>
</body>
</html>