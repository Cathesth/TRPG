import json
import logging
from typing import List, Dict, Optional

# í•„ìš”í•œ ëª¨ë“ˆ ì„í¬íŠ¸
try:
    from core.vector_db import get_vector_db_client
    from llm_factory import LLMFactory
except ImportError:
    pass

logger = logging.getLogger(__name__)


class ChatbotService:
    @staticmethod
    async def generate_response(user_query: str, chat_history: List[Dict] = None) -> dict:
        """
        ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ë°›ì•„ ë‹µë³€ì„ ìƒì„±í•©ë‹ˆë‹¤.
        """
        # [í•™ìŠµ ë‚´ìš©] AIì—ê²Œ ì£¼ì…í•  í”„ë¡œì íŠ¸ ì§€ì‹ ì •ë³´
        context_text = """
        [TRPG Studio ì„œë¹„ìŠ¤ ì •ë³´]
        1. ì„œë¹„ìŠ¤ ê°œìš”: ì—¬ìš¸(YEOUL)ì€ ë©€í‹° ì—ì´ì „íŠ¸ AI ê¸°ë°˜ì˜ ì¸í„°ë™í‹°ë¸Œ TRPG í”Œë«í¼ì…ë‹ˆë‹¤.
        2. ì‹œë‚˜ë¦¬ì˜¤ ì œì‘ (Builder Mode): ë…¸ë“œ ê¸°ë°˜ í¸ì§‘ê¸°, AI ë³´ì¡° ë„êµ¬(NPC/ì§€ë¬¸ ìƒì„±), ë¡œì§ ê²€ìˆ˜ ì œê³µ.
        3. ìš”ê¸ˆì œ: Free(3ê°œ ìƒì„±), Pro(9,900ì›/ë¬´ì œí•œ/GPT-4), Biz(29,900ì›/íŒŒì¸íŠœë‹).
        4. í”Œë ˆì´: ë©”ì¸ í™”ë©´ ë¦¬ìŠ¤íŠ¸ ì„ íƒ -> 1:1 AI GMê³¼ í”Œë ˆì´.
        """

        try:
            # LLM í˜¸ì¶œ ì‹œë„
            if 'LLMFactory' in globals() and hasattr(LLMFactory, 'create_llm'):
                try:
                    # ëŒ€í™” íˆìŠ¤í† ë¦¬ í¬ë§·íŒ…
                    history_text = ""
                    if chat_history:
                        recent_history = chat_history[-3:]
                        for msg in recent_history:
                            role = "User" if msg.get('role') == 'user' else "AI"
                            history_text += f"{role}: {msg.get('content')}\n"

                    system_prompt = f"""
                    ë‹¹ì‹ ì€ TRPG Studioì˜ ì¹œì ˆí•˜ê³  ì¬ì¹˜ ìˆëŠ” AI ê°€ì´ë“œ 'ì—¬ìš¸'ì…ë‹ˆë‹¤.
                    ì‚¬ìš©ìëŠ” TRPG ê²Œì„ì„ ë§Œë“¤ê±°ë‚˜ í”Œë ˆì´í•˜ëŠ” ìœ ì €ì…ë‹ˆë‹¤.

                    [ì§€ì¹¨]
                    1. ì œê³µëœ 'Context' ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì •í™•í•˜ê²Œ ë‹µë³€í•˜ì„¸ìš”.
                    2. ì •ë³´ê°€ ì—†ë‹¤ë©´ ì†”ì§íˆ ëª¨ë¥´ê² ë‹¤ê³  í•˜ê³ , ë©”ë‰´ ì´ìš©ì„ ê¶Œì¥í•˜ì„¸ìš”.
                    3. ë§íˆ¬ëŠ” ì¹œì ˆí•˜ê³  ê²©ë ¤í•˜ëŠ” í†¤("~í•´ìš”", "~í•´ë³´ì„¸ìš”!")ì„ ì‚¬ìš©í•˜ì„¸ìš”.
                    4. ë‹µë³€ ëì—ëŠ” í•­ìƒ ì‚¬ìš©ìê°€ ì´ì–´ì„œ í•  ë²•í•œ ì§ˆë¬¸ 2~3ê°œë¥¼ 'choices'ì— ë‹´ì•„ ì£¼ì„¸ìš”.

                    [ì´ì „ ëŒ€í™” ì°¸ê³ ]
                    {history_text}

                    ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ì„ ì§€ì¼œì„œ ì‘ë‹µí•˜ì„¸ìš”. (ë§ˆí¬ë‹¤ìš´ ì—†ì´ ìˆœìˆ˜ JSONë§Œ)
                    {{
                        "answer": "ë‹µë³€ ë‚´ìš©... (ì¤„ë°”ê¿ˆì€ \\n ì‚¬ìš©)",
                        "choices": ["ì„ íƒì§€1", "ì„ íƒì§€2"]
                    }}
                    """

                    llm = LLMFactory.create_llm("gpt-4o")
                    response_text = await llm.chat_completion(
                        system_prompt=system_prompt,
                        user_input=f"Context: {context_text}\n\nQuestion: {user_query}"
                    )
                    cleaned_text = response_text.replace("```json", "").replace("```", "").strip()
                    return json.loads(cleaned_text)
                except Exception as e:
                    logger.warning(f"LLM í˜¸ì¶œ ì‹¤íŒ¨ (Fallback ì „í™˜): {e}")
                    return ChatbotService.get_keyword_response(user_query)
            else:
                return ChatbotService.get_keyword_response(user_query)

        except Exception as e:
            logger.error(f"Chatbot Critical Error: {e}")
            return ChatbotService.get_keyword_response(user_query)

    # â–¼â–¼â–¼ [ìµœì¢… ìˆ˜ì •] í‚¤ì›Œë“œ ë¶„ì„ ë¡œì§ (ëª¨ë“  ì§ˆë¬¸ ëŒ€ì‘) â–¼â–¼â–¼
    @staticmethod
    def get_keyword_response(query: str) -> dict:
        """
        AI ëª¨ë¸ ì—°ê²° ë¶ˆê°€ ì‹œ, í‚¤ì›Œë“œ ì ìˆ˜(Score) ê¸°ë°˜ìœ¼ë¡œ ê°€ì¥ ì í•©í•œ ë‹µë³€ì„ ì°¾ìŠµë‹ˆë‹¤.
        """
        query = query.lower().strip()

        # ë‹µë³€ í…œí”Œë¦¿ ë¦¬ìŠ¤íŠ¸
        responses = [
            # -----------------------------------------------------------
            # 1. ì‹œë‚˜ë¦¬ì˜¤/í”„ë¦¬ì…‹ ê´€ë¦¬
            # -----------------------------------------------------------

            # [í”„ë¦¬ì…‹ ì €ì¥]
            {
                "keywords": ['í”„ë¦¬ì…‹', 'preset', 'ì €ì¥', 'save', 'ë‹¤ìš´ë¡œë“œ', 'ë°±ì—…'],
                "required": ['í”„ë¦¬ì…‹', 'preset'],
                "answer": "ğŸ’¾ **í”„ë¦¬ì…‹(Preset) ì €ì¥**\n\ní˜„ì¬ ìº”ë²„ìŠ¤ì— ê·¸ë ¤ì§„ **ë…¸ë“œì™€ ì—°ê²° êµ¬ì¡°**ë¥¼ ë‚´ ì»´í“¨í„°ì— **JSON íŒŒì¼**ë¡œ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.\n\nì‘ì—… ì¤‘ì¸ ë°°ì¹˜ë¥¼ ë°±ì—…í•˜ê±°ë‚˜, ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì¡°ë¥¼ ê³µìœ í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.",
                "choices": ["í”„ë¦¬ì…‹ ë¡œë“œê°€ ë­”ê°€ìš”?", "ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ê³¼ ì°¨ì´ì ", "ë¹Œë” ëª¨ë“œ ì´ë™"]
            },

            # [í”„ë¦¬ì…‹ ë¡œë“œ]
            {
                "keywords": ['í”„ë¦¬ì…‹', 'preset', 'ë¡œë“œ', 'load', 'ë¶ˆëŸ¬ì˜¤ê¸°', 'ì—´ê¸°'],
                "required": ['í”„ë¦¬ì…‹', 'preset'],
                "answer": "ğŸ“‚ **í”„ë¦¬ì…‹(Preset) ë¡œë“œ**\n\nì»´í“¨í„°ì— ê°€ì§€ê³  ìˆëŠ” **í”„ë¦¬ì…‹ íŒŒì¼(.json)**ì„ ìº”ë²„ìŠ¤ì— ì ìš©í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.\n\nâš ï¸ **ì£¼ì˜:** í”„ë¦¬ì…‹ì„ ë¡œë“œí•˜ë©´ í˜„ì¬ ìº”ë²„ìŠ¤ì˜ ë‚´ìš©ì€ ì‚¬ë¼ì§€ê³  í”„ë¦¬ì…‹ì˜ êµ¬ì¡°ë¡œ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.",
                "choices": ["í”„ë¦¬ì…‹ ì €ì¥ì´ ë­”ê°€ìš”?", "ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œë€?", "ë¹Œë” ëª¨ë“œ ì´ë™"]
            },

            # [ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ]
            {
                "keywords": ['ì‹œë‚˜ë¦¬ì˜¤', 'scenario', 'ì‘í’ˆ', 'ë¡œë“œ', 'load', 'ë¶ˆëŸ¬ì˜¤ê¸°', 'ì—´ê¸°', 'ëª©ë¡', 'ë¦¬ìŠ¤íŠ¸'],
                "required": ['ì‹œë‚˜ë¦¬ì˜¤', 'ì‘í’ˆ'],
                "answer": "ğŸ“– **ë‚´ ì‹œë‚˜ë¦¬ì˜¤ ë³´ê¸° (Load Scenario)**\n\nì„œë²„ì— ì €ì¥ëœ ë‚´ ì‘í’ˆì„ ë¶ˆëŸ¬ì˜¤ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?\n\n1. ìš°ì¸¡ ìƒë‹¨ í”„ë¡œí•„ í´ë¦­ > **ë§ˆì´í˜ì´ì§€**ë¡œ ì´ë™í•©ë‹ˆë‹¤.\n2. **'ë‚´ ì‹œë‚˜ë¦¬ì˜¤'** íƒ­ì—ì„œ ì‘ì„± ì¤‘ì¸ ëª©ë¡ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n3. ì›í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í´ë¦­í•˜ë©´ ì—ë””í„°ë¡œ ë¶ˆëŸ¬ì™€ì§‘ë‹ˆë‹¤.",
                "choices": ["ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™", "í”„ë¦¬ì…‹ ë¡œë“œì™€ ì°¨ì´ì ", "ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ë§Œë“¤ê¸°"]
            },

            # [í”„ë¦¬ì…‹ vs ì‹œë‚˜ë¦¬ì˜¤ ì°¨ì´]
            {
                "keywords": ['í”„ë¦¬ì…‹', 'ì‹œë‚˜ë¦¬ì˜¤', 'ì°¨ì´', 'vs', 'ë¹„êµ', 'ë‹¤ë¥¸'],
                "required": ['í”„ë¦¬ì…‹', 'ì‹œë‚˜ë¦¬ì˜¤'],
                "answer": "âš–ï¸ **í”„ë¦¬ì…‹ ë¡œë“œ vs ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ ì°¨ì´ì **\n\në‘ ê¸°ëŠ¥ì€ **'ì–´ë””ì„œ'** ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠëƒê°€ ë‹¤ë¦…ë‹ˆë‹¤.\n\nâ€¢ **í”„ë¦¬ì…‹ ë¡œë“œ**: ë‚´ ì»´í“¨í„°ì— ì €ì¥ëœ **JSON íŒŒì¼(êµ¬ì¡°)**ì„ ìº”ë²„ìŠ¤ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. (ë¡œì»¬ íŒŒì¼)\nâ€¢ **ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ**: ì„œë²„ì— ì €ì¥ëœ **ë‚´ í”„ë¡œì íŠ¸**ë¥¼ í¸ì§‘ê¸°ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. (í´ë¼ìš°ë“œ DB)\n\nì¦‰, í”„ë¦¬ì…‹ì€ 'ë‹¨ìˆœ ë„ë©´ ë°±ì—…', ì‹œë‚˜ë¦¬ì˜¤ëŠ” 'ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ ì „ì²´'ë¼ê³  ì´í•´í•˜ì‹œë©´ ë©ë‹ˆë‹¤!",
                "choices": ["í”„ë¦¬ì…‹ ì €ì¥ì´ ë­”ê°€ìš”?", "ì‹œë‚˜ë¦¬ì˜¤ ì œì‘ ë°©ë²•", "ë¹Œë” ëª¨ë“œ ì´ë™"]
            },

            # -----------------------------------------------------------
            # 2. ë¹Œë”(ì œì‘) ìƒì„¸ ê¸°ëŠ¥
            # -----------------------------------------------------------

            # [NPC ìƒì„± ê°€ì´ë“œ]
            {
                "keywords": ['npc', 'ë“±ì¥ì¸ë¬¼', 'ìºë¦­í„°', 'ì¸ë¬¼', 'ë§Œë“¤', 'ìƒì„±', 'ì¶”ê°€', 'ë°©ë²•'],
                "required": ['npc'],
                "answer": "ğŸ‘¥ **NPC ìƒì„± ê°€ì´ë“œ**\n\nNPC ìƒì„± íƒ­ì—ì„œ ë‹¤ìŒ ì •ë³´ë¥¼ ì…ë ¥í•˜ì—¬ ëª¨í—˜ì„ ë•ê±°ë‚˜ ë°©í•´í•˜ëŠ” ì¸ë¬¼ì„ ë§Œë“­ë‹ˆë‹¤.\n\nâ€¢ **í•„ìˆ˜**: ì´ë¦„, ì—­í• /ì§ì—…, ì„±ê²©/íŠ¹ì§•, ëŒ€í‘œ ëŒ€ì‚¬\nâ€¢ **ìƒì„¸**: ì™¸ëª¨ ë¬˜ì‚¬, ë°°ê²½ ì„¤ì •, ìˆ¨ê²¨ì§„ ë¹„ë°€\nâ€¢ **ì„¤ì •**: ë‚˜ì´ëŒ€, í˜‘ë ¥ë„(ìš°í˜¸/ì¤‘ë¦½/ë¹„í˜‘ì¡°)\n\nìƒì„±ëœ NPCëŠ” ì‹œë‚˜ë¦¬ì˜¤ì— ìƒë™ê°ì„ ë”í•˜ê³  í”Œë ˆì´ì–´ì™€ ìƒí˜¸ì‘ìš©í•©ë‹ˆë‹¤.",
                "choices": ["ì (Enemy) ìƒì„± ë°©ë²•", "ì•„ì´í…œ ìƒì„± ë°©ë²•", "AI ìë™ ìƒì„± íŒ"]
            },

            # [ì (Enemy) ìƒì„± ê°€ì´ë“œ]
            {
                "keywords": ['ì ', 'enemy', 'ëª¬ìŠ¤í„°', 'monster', 'ëª¹', 'ë§Œë“¤', 'ìƒì„±', 'ì¶”ê°€', 'ë°©ë²•'],
                "required": ['ì ', 'enemy', 'ëª¬ìŠ¤í„°', 'monster'],
                "answer": "âš”ï¸ **ì (Enemy) ìƒì„± ê°€ì´ë“œ**\n\nì „íˆ¬ íƒ­ì—ì„œ í”Œë ˆì´ì–´ë¥¼ ìœ„í˜‘í•˜ëŠ” ì ì„ ìƒì„±í•©ë‹ˆë‹¤.\n\nâ€¢ **ê¸°ë³¸**: ì´ë¦„, ì¢…ì¡±/ìœ í˜•, ë‚œì´ë„(í•˜~ë³´ìŠ¤)\nâ€¢ **ìŠ¤íƒ¯**: ì²´ë ¥(HP), ê³µê²©ë ¥(ATK)\nâ€¢ **ìƒì„¸**: íŠ¹ì§•/ê³µê²© íŒ¨í„´, ì•½ì , ë“œë ì•„ì´í…œ\n\nìƒì„±ëœ ì ì€ ì „íˆ¬ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ë“±ì¥í•˜ì—¬ ê¸´ì¥ê°ì„ ì¤ë‹ˆë‹¤.",
                "choices": ["NPC ìƒì„± ë°©ë²•", "ì•„ì´í…œ ìƒì„± ë°©ë²•", "ì „íˆ¬ ì‹œìŠ¤í…œ ì•ˆë‚´"]
            },

            # [ì•„ì´í…œ(Item) ìƒì„± ê°€ì´ë“œ]
            {
                "keywords": ['ì•„ì´í…œ', 'item', 'ë¬¼ê±´', 'ë³´ìƒ', 'ë§Œë“¤', 'ìƒì„±', 'ì¶”ê°€', 'ì œì‘', 'ë°©ë²•'],
                "required": ['ì•„ì´í…œ'],
                "answer": "ğŸ’ **ì•„ì´í…œ(Item) ìƒì„± ê°€ì´ë“œ**\n\nì•„ì´í…œ íƒ­ì—ì„œ ë³´ìƒì´ë‚˜ ì¤‘ìš” ë¬¼í’ˆì„ ìƒì„±í•©ë‹ˆë‹¤.\n\nâ€¢ **ì •ë³´**: ì´ë¦„, ìœ í˜•(ë¬´ê¸°/ë°©ì–´êµ¬/ì†Œëª¨í’ˆ ë“±)\nâ€¢ **ìƒì„¸**: íš¨ê³¼/ëŠ¥ë ¥ì¹˜, ì„¤ëª…/ì™¸í˜•\n\nì  ì²˜ì¹˜ ë³´ìƒì´ë‚˜ ì´ë²¤íŠ¸ íšë“ ì•„ì´í…œìœ¼ë¡œ í™œìš©ë©ë‹ˆë‹¤.",
                "choices": ["NPC ìƒì„± ë°©ë²•", "ì  ìƒì„± ë°©ë²•", "ì•„ì´í…œ ì‚¬ìš© ë°©ë²•"]
            },

            # [ì”¬ ì¶”ê°€ ë°©ë²•]
            {
                "keywords": ['ì”¬', 'scene', 'ì¶”ê°€', 'ìƒì„±', 'ë§Œë“¤', 'ë°©ë²•', 'how', 'ì–´ë–»ê²Œ'],
                "required": ['ì”¬', 'scene'],
                "answer": "ğŸ¬ **Scene(ì¥ë©´) ì¶”ê°€ ë°©ë²•**\n\nìƒˆë¡œìš´ ì¥ë©´ì„ ì¶”ê°€í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?\n\n1. ìº”ë²„ìŠ¤ í™”ë©´ì˜ ë¹ˆ ê³µê°„ì„ **ìš°í´ë¦­** í•˜ì„¸ìš”.\n2. ë‚˜íƒ€ë‚˜ëŠ” ë©”ë‰´ì—ì„œ **'Add Scene'**ì„ ì„ íƒí•˜ì„¸ìš”.\n3. ë˜ëŠ” ìƒë‹¨ íˆ´ë°”ì˜ **'+' ë²„íŠ¼**ì„ í´ë¦­í•´ë„ ë©ë‹ˆë‹¤.",
                "choices": ["ì”¬ ë°°ê²½ ì„¤ì •", "ë‚´ìš© AI ì‘ì„±", "ì—”ë”© ì¶”ê°€ ë°©ë²•"]
            },

            # [ì”¬ ë°°ê²½ ì„¤ì •]
            {
                "keywords": ['ë°°ê²½', 'background', 'bg', 'ì„¤ì •', 'ë³€ê²½', 'ë°”ê¾¸', 'ì´ë¯¸ì§€', 'ë„£ê¸°'],
                "required": ['ë°°ê²½', 'background'],
                "answer": "ğŸ–¼ï¸ **ì”¬ ë°°ê²½ ì„¤ì • ë°©ë²•**\n\nì¥ë©´ì— ì–´ìš¸ë¦¬ëŠ” ë°°ê²½ì„ ë„£ì–´ë³´ì„¸ìš”!\n\n1. í¸ì§‘í•˜ë ¤ëŠ” **ì”¬ ë…¸ë“œë¥¼ í´ë¦­**í•˜ì—¬ ì—ë””í„°ë¥¼ ì—½ë‹ˆë‹¤.\n2. **'Image / Background'** ì„¹ì…˜ì„ ì°¾ìŠµë‹ˆë‹¤.\n3. ì´ë¯¸ì§€ URLì„ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜, **'AI ìƒì„±'** ë²„íŠ¼ìœ¼ë¡œ ì¦‰ì„ì—ì„œ ê·¸ë¦¼ì„ ê·¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                "choices": ["ì´ë¯¸ì§€ ìƒì„± ë°©ë²•", "ë‚´ìš© AI ì‘ì„±", "ë¹Œë” ëª¨ë“œ ì´ë™"]
            },

            # [ë‚´ìš© AI ì‘ì„±]
            {
                "keywords": ['ë‚´ìš©', 'ì§€ë¬¸', 'text', 'ë³¸ë¬¸', 'ì‘ì„±', 'magic', 'write', 'ìë™', 'ì¨ì¤˜'],
                "required": ['ë‚´ìš©', 'ì§€ë¬¸', 'text', 'ì‘ì„±'],
                "answer": "âœ¨ **ë‚´ìš© AI ì‘ì„± (Magic Write)**\n\nê¸€ì“°ê¸°ê°€ ë§‰ë§‰í•  ë•Œ ì‚¬ìš©í•˜ì„¸ìš”!\n\n1. ì”¬ ì—ë””í„°ì˜ í…ìŠ¤íŠ¸ ì…ë ¥ì°½ ìš°ì¸¡ì— ìˆëŠ” **ë§ˆë²•ë´‰ ì•„ì´ì½˜(ğŸª„)**ì„ í´ë¦­í•©ë‹ˆë‹¤.\n2. 'ì–´ë‘ìš´ ìˆ², ê¸´ì¥ê°' ê°™ì€ **í‚¤ì›Œë“œ**ë‚˜ **ìƒí™©**ì„ ì§§ê²Œ ì…ë ¥í•©ë‹ˆë‹¤.\n3. AIê°€ ê·¸ì— ë§ëŠ” ë©‹ì§„ ë¬˜ì‚¬ë¥¼ ìë™ìœ¼ë¡œ ì‘ì„±í•´ ì¤ë‹ˆë‹¤.",
                "choices": ["ì´ë¯¸ì§€ ìƒì„± ë°©ë²•", "AI ë„êµ¬ ì†Œê°œ", "ë¹Œë” ëª¨ë“œ ì´ë™"]
            },

            # [ì´ë¯¸ì§€ ìƒì„± ë°©ë²•]
            {
                "keywords": ['ì´ë¯¸ì§€', 'ê·¸ë¦¼', 'ì‚½í™”', 'image', 'picture', 'ìƒì„±', 'ë§Œë“¤', 'gen', 'ê·¸ë ¤', 'ë°©ë²•', 'ì—‘ë°•', 'ê¹¨ì§', 'ì•ˆë‚˜ì™€'],
                "required": ['ì´ë¯¸ì§€', 'ê·¸ë¦¼', 'ì‚½í™”'],
                "answer": "ğŸ¨ **AI ì´ë¯¸ì§€ ìƒì„± ë° ë¬¸ì œ í•´ê²°**\n\n1. **ìƒì„± ë°©ë²•**: ì”¬ ì—ë””í„° í•˜ë‹¨ì˜ **'Generate Image'** ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.\n2. **ì—‘ë°•(ê¹¨ì§) í˜„ìƒ**: ì´ë¯¸ì§€ê°€ ë¡œë”©ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´, **ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨**ì„ í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”. ë„¤íŠ¸ì›Œí¬ ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                "choices": ["ì”¬ ë°°ê²½ ì„¤ì •", "ë‚´ìš© AI ì‘ì„±", "ìš”ê¸ˆì œ ì•ˆë‚´"]
            },

            # [ì—”ë”© ì¶”ê°€]
            {
                "keywords": ['ì—”ë”©', 'ending', 'ê²°ë§', 'ë', 'finish', 'ë§Œë“¤', 'ì¶”ê°€', 'ë°©ë²•'],
                "required": ['ì—”ë”©', 'ê²°ë§', 'ë'],
                "answer": "ğŸ **Ending(ì—”ë”©) ë§Œë“œëŠ” ë²•**\n\nì´ì•¼ê¸°ì˜ ëì„ ë§Œë“œëŠ” ë°©ë²•ì€ ê°„ë‹¨í•©ë‹ˆë‹¤.\n\n1. ìƒˆë¡œìš´ ì”¬ì„ ì¶”ê°€í•˜ì—¬ ê²°ë§ ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”.\n2. í•´ë‹¹ ì”¬ì—ì„œ **ë‹¤ë¥¸ ì”¬ìœ¼ë¡œ ì—°ê²°ë˜ëŠ” ì„ íƒì§€(Choice)ë¥¼ ë§Œë“¤ì§€ ì•Šìœ¼ë©´**, ê²Œì„ ì‹œìŠ¤í…œì´ ì´ë¥¼ ìë™ìœ¼ë¡œ **ì—”ë”©(Ending)**ìœ¼ë¡œ ì¸ì‹í•©ë‹ˆë‹¤.",
                "choices": ["ì”¬ ì¶”ê°€ ë°©ë²•", "ë‚´ìš© AI ì‘ì„±", "ë¹Œë” ëª¨ë“œ ì´ë™"]
            },

            # [AI ë„êµ¬ ì†Œê°œ]
            {
                "keywords": ['ai', 'ë„êµ¬', 'tool', 'ì¸ê³µì§€ëŠ¥', 'ê¸°ëŠ¥', 'ë­ì•¼', 'ë­”ê°€ìš”', 'ì†Œê°œ', 'ì¢…ë¥˜'],
                "required": ['ai', 'ë„êµ¬'],
                "answer": "ğŸ¤– **AI ë³´ì¡° ë„êµ¬ ì†Œê°œ**\n\nTRPG StudioëŠ” ì°½ì‘ìë¥¼ ìœ„í•œ ê°•ë ¥í•œ AI ë„êµ¬ 3ê°€ì§€ë¥¼ ì œê³µí•©ë‹ˆë‹¤.\n\n1. **NPC ì œë„¤ë ˆì´í„°**: ì„±ê²©/ë°°ê²½/ëŒ€ì‚¬ë¥¼ ìë™ ìƒì„±\n2. **Magic Write**: ì§€ë¬¸/ë‚´ìš© ìë™ ì‘ì„±\n3. **ë¡œì§ ê²€ìˆ˜ê¸°**: ì—°ê²° ì˜¤ë¥˜ ìë™ ë¶„ì„\n\në¹Œë” ëª¨ë“œì—ì„œ ì´ ê¸°ëŠ¥ë“¤ì„ í™œìš©í•´ ë³´ì„¸ìš”!",
                "choices": ["ë‚´ìš© AI ì‘ì„±", "ì´ë¯¸ì§€ ìƒì„± ë°©ë²•", "ì²˜ìŒìœ¼ë¡œ"]
            },

            # [ì‹œë‚˜ë¦¬ì˜¤ ê³µê°œ ì„¤ì •]
            {
                "keywords": ['ê³µê°œ', 'ê³µìœ ', 'publish', 'ë°°í¬', 'ë‹¤ë¥¸', 'ì‚¬ëŒ'],
                "required": ['ê³µê°œ', 'ê³µìœ ', 'ë°°í¬'],
                "answer": "ğŸŒ **ì‹œë‚˜ë¦¬ì˜¤ ê³µê°œ (Publish)**\n\nì™„ì„±ëœ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n1. ë¹Œë” ëª¨ë“œ ìƒë‹¨ì˜ **'Publish'** ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.\n2. ê³µê°œ ì„¤ì •ì´ ì™„ë£Œë˜ë©´, ë©”ì¸ í™”ë©´ì˜ ë¦¬ìŠ¤íŠ¸ì— ë‚´ ì‹œë‚˜ë¦¬ì˜¤ê°€ ë“±ë¡ë˜ì–´ ëˆ„êµ¬ë‚˜ í”Œë ˆì´í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.",
                "choices": ["ì‹œë‚˜ë¦¬ì˜¤ ì œì‘ ë°©ë²•", "ë¹Œë” ëª¨ë“œ ì´ë™", "ì²˜ìŒìœ¼ë¡œ"]
            },

            # -----------------------------------------------------------
            # 3. ìš”ê¸ˆì œ, ê³„ì •, ë¬¸ì˜
            # -----------------------------------------------------------

            # [íšŒì› ê°€ì…/ì‹œì‘]
            {
                "keywords": ['ê°€ì…', 'register', 'sign', 'ì‹œì‘', 'ì²˜ìŒ', 'start'],
                "required": ['ê°€ì…', 'ì‹œì‘', 'ì²˜ìŒ'],
                "answer": "ğŸ‘‹ **TRPG Studio ì‹œì‘í•˜ê¸°**\n\ní™˜ì˜í•©ë‹ˆë‹¤! ìš°ì¸¡ ìƒë‹¨ì˜ **'LOGIN'** ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.\n\nêµ¬ê¸€, ì¹´ì¹´ì˜¤, ë„¤ì´ë²„ ê³„ì •ìœ¼ë¡œ **ê°„í¸í•˜ê²Œ íšŒì›ê°€ì… ë° ë¡œê·¸ì¸**í•˜ì—¬ ë°”ë¡œ ëª¨í—˜ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                "choices": ["ê²Œì„ í”Œë ˆì´ ë°©ë²•", "ì‹œë‚˜ë¦¬ì˜¤ ì œì‘ ë°©ë²•", "ìš”ê¸ˆì œ ì•ˆë‚´"]
            },

            # [ë¹„ë°€ë²ˆí˜¸ ë³€ê²½/ì°¾ê¸°]
            {
                "keywords": ['ë¹„ë²ˆ', 'ë¹„ë°€ë²ˆí˜¸', 'password', 'ë³€ê²½', 'ì°¾ê¸°', 'ë¶„ì‹¤', 'ê¹Œë¨¹'],
                "required": ['ë¹„ë²ˆ', 'ë¹„ë°€ë²ˆí˜¸', 'password'],
                "answer": "ğŸ” **ë¹„ë°€ë²ˆí˜¸ ê´€ë¦¬**\n\nì†Œì…œ ë¡œê·¸ì¸(êµ¬ê¸€/ì¹´ì¹´ì˜¤/ë„¤ì´ë²„)ì„ ì´ìš©í•˜ì‹œëŠ” ê²½ìš°, í•´ë‹¹ ì†Œì…œ ì„œë¹„ìŠ¤ì—ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.\n\nì´ë©”ì¼ë¡œ ê°€ì…í•˜ì‹  ê²½ìš°, **ë§ˆì´í˜ì´ì§€ > í”„ë¡œí•„ ìˆ˜ì •**ì—ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                "choices": ["ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™", "ë¡œê·¸ì¸ ë°©ë²•", "ì²˜ìŒìœ¼ë¡œ"]
            },

            # [íšŒì› íƒˆí‡´]
            {
                "keywords": ['íƒˆí‡´', 'ì‚­ì œ', 'delete', 'withdraw', 'ê·¸ë§Œ'],
                "required": ['íƒˆí‡´', 'ì‚­ì œ', 'ê·¸ë§Œ'],
                "answer": "ğŸ˜¢ **íšŒì› íƒˆí‡´ ì•ˆë‚´**\n\në– ë‚˜ì‹ ë‹¤ë‹ˆ ì•„ì‰½ìŠµë‹ˆë‹¤.\n\níšŒì› íƒˆí‡´ëŠ” **ë§ˆì´í˜ì´ì§€ > í”„ë¡œí•„ ìˆ˜ì •** ë©”ë‰´ í•˜ë‹¨ì˜ **'íšŒì› íƒˆí‡´'** ë²„íŠ¼ì„ í†µí•´ ì§„í–‰í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\níƒˆí‡´ ì‹œ ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ì™€ ë°ì´í„°ê°€ ì‚­ì œë˜ë‹ˆ ì‹ ì¤‘í•˜ê²Œ ê²°ì •í•´ ì£¼ì„¸ìš”.",
                "choices": ["ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™", "ë¬¸ì˜í•˜ê¸°", "ì²˜ìŒìœ¼ë¡œ"]
            },

            # [ë¬´ë£Œ ê¸°ëŠ¥/íšŒì›]
            {
                "keywords": ['ë¬´ë£Œ', 'free', 'ê¸°ëŠ¥', 'adventurer', 'ê³µì§œ', 'ëª‡ê°œ', 'ì œí•œ'],
                "required": ['ë¬´ë£Œ', 'free', 'ê³µì§œ'],
                "answer": "ğŸ’ **Adventurer (Free) í”Œëœ ì•ˆë‚´**\n\në¬´ë£Œ íšŒì›ë„ ì¶©ë¶„íˆ ì¦ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤!\n\nâœ… **ì œê³µ ê¸°ëŠ¥**\nâ€¢ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±: ìµœëŒ€ **3ê°œ**\nâ€¢ ê¸°ë³¸ AI ëª¨ë¸(GPT-3.5) ë¬´ì œí•œ ì‚¬ìš©\nâ€¢ ë‹¤ë¥¸ ìœ ì €ì˜ ê³µê°œ ì‹œë‚˜ë¦¬ì˜¤ **ë¬´ì œí•œ í”Œë ˆì´**\nâ€¢ ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥ ì´ìš© ê°€ëŠ¥\n\në¶€ë‹´ ì—†ì´ ëª¨í—˜ì„ ì‹œì‘í•´ ë³´ì„¸ìš”!",
                "choices": ["ìš”ê¸ˆì œ ì•ˆë‚´", "ì‹œë‚˜ë¦¬ì˜¤ ì œì‘ ë°©ë²•", "ì²˜ìŒìœ¼ë¡œ"]
            },

            # [ìš”ê¸ˆì œ ì•ˆë‚´]
            {
                "keywords": ['ìš”ê¸ˆ', 'ê°€ê²©', 'ë¹„ìš©', 'ê²°ì œ', 'plan', 'êµ¬ë…', 'ì–¼ë§ˆ', 'ìœ ë£Œ', 'ì•ˆë‚´'],
                "required": ['ìš”ê¸ˆ', 'ê°€ê²©', 'ë¹„ìš©', 'ê²°ì œ', 'plan', 'êµ¬ë…', 'ì–¼ë§ˆ', 'ìœ ë£Œ'],
                "answer": "ğŸ’³ **ìš”ê¸ˆì œ ì•ˆë‚´**\n\nëª¨í—˜ê°€ë‹˜ì˜ ìŠ¤íƒ€ì¼ì— ë§ëŠ” í”Œëœì„ ì„ íƒí•˜ì„¸ìš”!\n\nğŸ”¹ **Adventurer (Free)**: ë¬´ë£Œ, ì‹œë‚˜ë¦¬ì˜¤ 3ê°œ\nğŸ”¹ **Dungeon Master (9,900ì›/ì›”)**: ë¬´ì œí•œ ìƒì„±, GPT-4, ì´ë¯¸ì§€ 50íšŒ\nğŸ”¹ **World Creator (29,900ì›/ì›”)**: ëª¨ë“  ê¸°ëŠ¥ + ì „ìš© íŒŒì¸íŠœë‹ ëª¨ë¸\n\nìì„¸í•œ ë‚´ìš©ì€ **ë§ˆì´í˜ì´ì§€**ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
                "choices": ["ë¬´ë£Œ ê¸°ëŠ¥ ë” ë³´ê¸°", "ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™", "ì²˜ìŒìœ¼ë¡œ"]
            },

            # [ë¬¸ì˜í•˜ê¸°/ë²„ê·¸ ì‹ ê³ ]
            {
                "keywords": ['ë¬¸ì˜', 'contact', 'support', 'ì§ˆë¬¸', 'help', 'ë²„ê·¸', 'ì‹ ê³ ', 'ì˜¤ë¥˜', 'ê°œë°œì'],
                "required": ['ë¬¸ì˜', 'contact', 'ë²„ê·¸', 'ì‹ ê³ ', 'ì˜¤ë¥˜', 'ê°œë°œì'],
                "answer": "ğŸ“¬ **ë¬¸ì˜í•˜ê¸° ë° ë²„ê·¸ ì‹ ê³ **\n\nì„œë¹„ìŠ¤ ì´ìš© ì¤‘ ë¶ˆí¸í•œ ì ì´ë‚˜ ë²„ê·¸ë¥¼ ë°œê²¬í•˜ì…¨ë‚˜ìš”?\n\ní˜„ì¬ëŠ” ë² íƒ€ í…ŒìŠ¤íŠ¸ ê¸°ê°„ìœ¼ë¡œ, **ì»¤ë®¤ë‹ˆí‹°(ë””ìŠ¤ì½”ë“œ/ê²Œì‹œíŒ)**ë¥¼ í†µí•´ ê°œë°œìì—ê²Œ ì§ì ‘ ë¬¸ì˜í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në¹ ë¥¸ ì‹œì¼ ë‚´ì— 1:1 ë¬¸ì˜ ê¸°ëŠ¥ì„ ì œê³µí•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤!",
                "choices": ["í”Œë ˆì´ ë°©ë²•", "ì‹œë‚˜ë¦¬ì˜¤ ì œì‘ ë°©ë²•", "ì²˜ìŒìœ¼ë¡œ"]
            },

            # -----------------------------------------------------------
            # 4. í”Œë ˆì´ / ì¸ê²Œì„ (íŒíŠ¸ ë“±)
            # -----------------------------------------------------------

            # [ê²Œì„ í”Œë ˆì´ ë°©ë²•]
            {
                "keywords": ['ê²Œì„', 'í”Œë ˆì´', 'ì‹œì‘', 'ë°©ë²•', 'play', 'game', 'how'],
                "required": ['ê²Œì„', 'í”Œë ˆì´'],
                "answer": "ğŸ® **ê²Œì„ í”Œë ˆì´ ë°©ë²•**\n\nTRPG Studioì—ì„œëŠ” AI ê²Œì„ë§ˆìŠ¤í„°ì™€ í•¨ê»˜ ììœ ë¡œìš´ ëª¨í—˜ì„ ì¦ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n1. ë©”ì¸ í™”ë©´ì—ì„œ ì›í•˜ëŠ” **ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒ**í•˜ì„¸ìš”.\n2. **'PLAY'** ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.\n3. ìƒí™©ì— ë§ëŠ” **í–‰ë™ì´ë‚˜ ëŒ€ì‚¬**ë¥¼ ì…ë ¥í•˜ë©´ ìŠ¤í† ë¦¬ê°€ ì§„í–‰ë©ë‹ˆë‹¤.",
                "choices": ["ì „íˆ¬ëŠ” ì–´ë–»ê²Œ í•´ìš”?", "ì•„ì´í…œ ì‚¬ìš©ë²•", "íŒíŠ¸ê°€ í•„ìš”í•´ìš”"]
            },

            # [ëª¨ë°”ì¼ í”Œë ˆì´]
            {
                "keywords": ['ëª¨ë°”ì¼', 'í°', 'ìŠ¤ë§ˆíŠ¸í°', 'mobile', 'phone'],
                "required": ['ëª¨ë°”ì¼', 'í°'],
                "answer": "ğŸ“± **ëª¨ë°”ì¼ í”Œë ˆì´ ì§€ì›**\n\në„¤! TRPG StudioëŠ” ëª¨ë°”ì¼ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œë„ í”Œë ˆì´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\në‹¤ë§Œ, **ì‹œë‚˜ë¦¬ì˜¤ ì œì‘(ë¹Œë” ëª¨ë“œ)**ì€ í™”ë©´ì´ ë„“ì€ PC í™˜ê²½ì—ì„œ í•˜ì‹œëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
                "choices": ["ê²Œì„ í”Œë ˆì´ ë°©ë²•", "PC ê¶Œì¥ ì‚¬ì–‘", "ì²˜ìŒìœ¼ë¡œ"]
            },

            # [íŒíŠ¸ê°€ í•„ìš”í•´ìš”]
            {
                "keywords": ['ë§‰í˜”', 'íŒíŠ¸', 'hint', 'ëª¨ë¥´ê² ', 'ë„ì›€', 'í•„ìš”', 'ì–´ë–¡', 'ë°©ë²•'],
                "required": ['ë§‰í˜”', 'íŒíŠ¸', 'hint', 'ëª¨ë¥´ê² ', 'ë„ì›€'],
                "answer": "ğŸ’¡ **íŒíŠ¸ê°€ í•„ìš”í•˜ì‹ ê°€ìš”?**\n\nì§„í–‰ì´ ë§‰ë§‰í•  ë• ì´ë ‡ê²Œ í•´ë³´ì„¸ìš”:\n\n1. **\"ì£¼ë³€ì„ ìì„¸íˆ ì‚´í´ë³¸ë‹¤\"**ë¼ê³  ì…ë ¥í•˜ê¸°\n2. **\"ê°€ë°©ì— ì“¸ë§Œí•œ ê²Œ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤\"**ë¼ê³  ì…ë ¥í•˜ê¸°\n3. **\"GM, íŒíŠ¸ ì¢€ ì¤˜!\"**ë¼ê³  ì±„íŒ…ì°½ì— ì§ì ‘ ë¬¼ì–´ë³´ê¸°\n\nAI ê²Œì„ë§ˆìŠ¤í„°ê°€ ìƒí™©ì— ë§ëŠ” ì¡°ì–¸ì„ í•´ì¤„ ê±°ì˜ˆìš”!",
                "choices": ["ì „íˆ¬ëŠ” ì–´ë–»ê²Œ í•´ìš”?", "ì•„ì´í…œ ì‚¬ìš©ë²•", "ì´ì „ ëŒ€í™” ë³´ê¸°"]
            },

            # [ì•„ì´í…œ ì‚¬ìš© ë°©ë²•]
            {
                "keywords": ['ì•„ì´í…œ', 'item', 'ì‚¬ìš©', 'ì“°ëŠ”', 'ë¨¹ëŠ”', 'ë°©ë²•', 'ì–´ë–»ê²Œ'],
                "required": ['ì•„ì´í…œ', 'ì‚¬ìš©'],
                "answer": "ğŸ’ **ì•„ì´í…œ ì‚¬ìš© ë°©ë²•**\n\nê°€ì§€ê³  ìˆëŠ” ì•„ì´í…œì„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ í–‰ë™ìœ¼ë¡œ ì ì–´ì£¼ì„¸ìš”.\n\nì˜ˆì‹œ:\nâ€¢ \"ê°€ë°©ì—ì„œ í¬ì…˜ì„ êº¼ë‚´ ë§ˆì‹ ë‹¤.\"\nâ€¢ \"íšë“í•œ ì—´ì‡ ë¡œ ë¬¸ì„ ì—°ë‹¤.\"\n\ní˜„ì¬ ì†Œì§€í’ˆì€ í™”ë©´ì˜ **Inventory(ê°€ë°©)** íƒ­ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                "choices": ["ì¸ë²¤í† ë¦¬ í™•ì¸", "ì „íˆ¬ ë°©ë²•", "íŒíŠ¸ê°€ í•„ìš”í•´ìš”"]
            },

            # [ì¸ë²¤í† ë¦¬ í™•ì¸]
            {
                "keywords": ['ì¸ë²¤í† ë¦¬', 'inventory', 'ê°€ë°©', 'ì†Œì§€í’ˆ', 'í™•ì¸', 'ì—´ê¸°'],
                "required": ['ì¸ë²¤í† ë¦¬', 'inventory', 'ê°€ë°©', 'ì†Œì§€í’ˆ'],
                "answer": "ğŸ’ **ì¸ë²¤í† ë¦¬ í™•ì¸ ë°©ë²•**\n\ní˜„ì¬ ë³´ìœ  ì¤‘ì¸ ì•„ì´í…œì€ í™”ë©´ì˜ **Inventory(ê°€ë°©)** íƒ­ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì•„ì´í…œì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìœ¼ë©°, ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ ëŒ€í™”ì°½ì— \"(ì•„ì´í…œ ì´ë¦„)ì„ ì‚¬ìš©í•œë‹¤\"ê³  ì…ë ¥í•´ ì£¼ì„¸ìš”.",
                "choices": ["ì•„ì´í…œ ì‚¬ìš© ë°©ë²•", "ì•„ì´í…œ ìƒì„± ë°©ë²•", "ì „íˆ¬ ë°©ë²•"]
            },

            # [ì´ì „ ëŒ€í™” ë³´ê¸°]
            {
                "keywords": ['ì´ì „', 'ëŒ€í™”', 'ë¡œê·¸', 'log', 'ê¸°ë¡', 'ì§€ë‚œ', 'ë³´ê¸°', 'í™•ì¸'],
                "required": ['ì´ì „', 'ëŒ€í™”', 'ë¡œê·¸', 'ê¸°ë¡'],
                "answer": "ğŸ“œ **ì´ì „ ëŒ€í™”(ë¡œê·¸) í™•ì¸ ë°©ë²•**\n\nì§€ë‚˜ê°„ ì´ì•¼ê¸°ë‚˜ GMì˜ ë¬˜ì‚¬ë¥¼ ë‹¤ì‹œ ë³´ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?\n\nì±„íŒ…ì°½ í™”ë©´ì„ **ë§ˆìš°ìŠ¤ íœ ì´ë‚˜ í„°ì¹˜ë¡œ ìœ„ë¡œ ìŠ¤í¬ë¡¤**í•´ ë³´ì„¸ìš”.\nì´ì „ ëŒ€í™” ë‚´ìš©ë“¤ì´ ì‚¬ë¼ì§€ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ë‚¨ì•„ìˆìŠµë‹ˆë‹¤.",
                "choices": ["ì €ì¥ì€ ì–´ë–»ê²Œ í•˜ë‚˜ìš”?", "íŒíŠ¸ê°€ í•„ìš”í•´ìš”", "ì²˜ìŒìœ¼ë¡œ"]
            },

            # [ì €ì¥ ë°©ë²•]
            {
                "keywords": ['ì €ì¥', 'ì„¸ì´ë¸Œ', 'save', 'ìë™'],
                "required": ['ì €ì¥', 'ì„¸ì´ë¸Œ', 'save'],
                "answer": "ğŸ’¾ **ê²Œì„ ì €ì¥ ì•ˆë‚´**\n\nTRPG StudioëŠ” **ìë™ ì €ì¥(Auto Save)** ì‹œìŠ¤í…œì„ ì§€ì›í•©ë‹ˆë‹¤.\n\ní”Œë ˆì´ì–´ê°€ í–‰ë™ì„ ì…ë ¥í•˜ê³  AIê°€ ë‹µë³€í•  ë•Œë§ˆë‹¤ í„´ ë‹¨ìœ„ë¡œ ì„œë²„ì— ì €ì¥ë˜ë¯€ë¡œ, ì–¸ì œë“  ì¢…ë£Œí•˜ì…”ë„ ë‚˜ì¤‘ì— ì´ì–´ì„œ í”Œë ˆì´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                "choices": ["ì´ì „ ëŒ€í™” ë³´ê¸°", "íŒíŠ¸ê°€ í•„ìš”í•´ìš”", "ì²˜ìŒìœ¼ë¡œ"]
            },

            # [ì „íˆ¬/ê³µê²©]
            {
                "keywords": ['ì „íˆ¬', 'ê³µê²©', 'ì‹¸ì›€', 'attack', 'fight', 'ì£½ì´', 'ë°©ë²•', 'í•˜ë‚˜ìš”'],
                "required": ['ì „íˆ¬', 'ê³µê²©', 'ì‹¸ì›€'],
                "answer": "âš”ï¸ **ì „íˆ¬ ë° ê³µê²© ë°©ë²•**\n\nì ì„ ë§Œë‚¬ë‹¤ë©´ ê³µê²© ë°©ì‹ì„ **í–‰ë™ìœ¼ë¡œ ë¬˜ì‚¬**í•˜ì„¸ìš”.\n\nì˜ˆì‹œ:\nâ€¢ \"ë“¤ê³  ìˆëŠ” ê²€ì„ íœ˜ë‘˜ëŸ¬ ì ì„ ê³µê²©í•œë‹¤.\"\nâ€¢ \"í™”ì—¼êµ¬ ì£¼ë¬¸ì„ ì™¸ì›Œ ì ì—ê²Œ ë‚ ë¦°ë‹¤.\"\n\ní”Œë ˆì´ì–´ì˜ í–‰ë™ -> AIì˜ íŒì •(ëª…ì¤‘ ì—¬ë¶€) -> ì ì˜ ë°˜ê²© ìˆœì„œë¡œ í„´ì´ ì§„í–‰ë©ë‹ˆë‹¤.",
                "choices": ["ë„ë§ì¹  ìˆ˜ ìˆë‚˜ìš”?", "ì£¼ì‚¬ìœ„ êµ´ë¦¬ëŠ” ë²•", "ì•„ì´í…œ ì‚¬ìš©ë²•"]
            },

            # [ë„ë§/íšŒí”¼]
            {
                "keywords": ['ë„ë§', 'run', 'escape', 'í”¼í•˜', 'íšŒí”¼', 'ì‚´ë ¤', 'ë°©ë²•'],
                "required": ['ë„ë§', 'í”¼í•˜', 'íšŒí”¼'],
                "answer": "ğŸƒ **ë„ë§ì¹˜ê¸°**\n\nìœ„í—˜í•œ ìƒí™©ì¸ê°€ìš”?\n\n**\"ë’¤ë„ ëŒì•„ë³´ì§€ ì•Šê³  ì „ë ¥ ì§ˆì£¼í•´ ë„ë§ì¹œë‹¤\"** ë˜ëŠ” **\"ì—°ë§‰íƒ„ì„ ë¿Œë¦¬ê³  ìˆ¨ëŠ”ë‹¤\"** ì²˜ëŸ¼ êµ¬ì²´ì ìœ¼ë¡œ ì…ë ¥í•´ ë³´ì„¸ìš”.\nAIê°€ ìƒí™©ê³¼ ë¯¼ì²©ì„±ì„ ê³ ë ¤í•´ ì„±ê³µ ì—¬ë¶€ë¥¼ íŒì •í•´ ì¤„ ê²ƒì…ë‹ˆë‹¤.",
                "choices": ["ì „íˆ¬ëŠ” ì–´ë–»ê²Œ í•´ìš”?", "ì•„ì´í…œ ì‚¬ìš©ë²•"]
            },

            # [ì£¼ì‚¬ìœ„/íŒì •]
            {
                "keywords": ['ì£¼ì‚¬ìœ„', 'ë‹¤ì´ìŠ¤', 'dice', 'êµ´ë¦¬', 'íŒì •', 'rule', 'ë£°', 'ì„±ê³µ', 'ë°©ë²•'],
                "required": ['ì£¼ì‚¬ìœ„', 'ë‹¤ì´ìŠ¤', 'íŒì •'],
                "answer": "ğŸ² **í–‰ë™ íŒì • ì•ˆë‚´**\n\nTRPG StudioëŠ” **ìë™ íŒì • ì‹œìŠ¤í…œ**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.\n\në”°ë¡œ ì£¼ì‚¬ìœ„ ë²„íŠ¼ì„ ëˆ„ë¥¼ í•„ìš” ì—†ì´, **\"ë¬¸ì„ ë°œë¡œ ì°¹ë‹ˆë‹¤\"** ë˜ëŠ” **\"ê³ ë¸”ë¦°ì„ ê²€ìœ¼ë¡œ ì°Œë¥¸ë‹¤\"** ê°™ì´ í–‰ë™ì„ ê¸€ë¡œ ì ìœ¼ì„¸ìš”.\nAI GMì´ ìƒí™©ì— ë§ì¶° ìë™ìœ¼ë¡œ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦¬ê³  ê²°ê³¼ë¥¼ ì•Œë ¤ì¤ë‹ˆë‹¤!",
                "choices": ["ì „íˆ¬ëŠ” ì–´ë–»ê²Œ í•´ìš”?", "ì•„ì´í…œ ì‚¬ìš©ë²•", "íŒíŠ¸ê°€ í•„ìš”í•´ìš”"]
            },

            # [ì „ì²´ ì”¬ ë³´ê¸° / ë””ë²„ê·¸ ë„êµ¬]
            {
                "keywords": ['ì „ì²´', 'ì”¬', 'ë³´ê¸°', 'êµ¬ì¡°', 'map', 'ì§€ë„', 'ë””ë²„ê·¸', 'debug', 'ë²„ê·¸', 'ì‹œê°í™”', 'ë²Œë ˆ', 'ì•„ì´ì½˜'],
                "required": ['ì „ì²´', 'ë””ë²„ê·¸', 'debug', 'ì‹œê°í™”', 'ë²Œë ˆ', 'ì•„ì´ì½˜'],
                "answer": "ğŸ—ºï¸ **ì „ì²´ ì”¬(êµ¬ì¡°) ë³´ê¸° ë° ë””ë²„ê·¸**\n\ní™”ë©´ ìš°ì¸¡ í•˜ë‹¨ì˜ **ë²Œë ˆ ì•„ì´ì½˜(ğŸ›)**ì€ **ë””ë²„ê·¸ ëª¨ë“œ(Scene Visualizer)**ì…ë‹ˆë‹¤.\n\ní´ë¦­í•˜ë©´ í˜„ì¬ ì‹œë‚˜ë¦¬ì˜¤ì˜ ì „ì²´ ë…¸ë“œ êµ¬ì¡°ì™€ ì§„í–‰ ìƒí™©ì„ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (PC í™˜ê²½ ê¶Œì¥)",
                "choices": ["í”Œë ˆì´ ë°©ë²•", "ë¬¸ì˜í•˜ê¸°", "íŒíŠ¸ê°€ í•„ìš”í•´ìš”"]
            },

            # -----------------------------------------------------------
            # 5. ì¼ë°˜ / ê¸°íƒ€ (ìš°ì„ ìˆœìœ„ ë‚®ìŒ)
            # -----------------------------------------------------------

            # [ì‹œë‚˜ë¦¬ì˜¤ ì œì‘ (ì¼ë°˜)]
            {
                "keywords": ['ì‹œë‚˜ë¦¬ì˜¤', 'ì œì‘', 'ë§Œë“¤', 'ìƒì„±', 'ë¹Œë”', 'create', 'ë…¸ë“œ', 'ë°©ë²•'],
                "required": ['ì‹œë‚˜ë¦¬ì˜¤', 'ë¹Œë”', 'ë…¸ë“œ'],
                "answer": "ğŸ› ï¸ **ì‹œë‚˜ë¦¬ì˜¤ ì œì‘ (Builder Mode)**\n\nTRPG StudioëŠ” **ë…¸ë“œ(Node) ê¸°ë°˜ í¸ì§‘ê¸°**ë¥¼ ì œê³µí•©ë‹ˆë‹¤.\nì½”ë”© ì—†ì´ ì´ì•¼ê¸°ì˜ íë¦„ì„ ì‹œê°ì ìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ë‚˜ë§Œì˜ ëª¨í—˜ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nìƒë‹¨ì˜ **'Start Creation'** ë²„íŠ¼ì„ ëˆŒëŸ¬ ìº”ë²„ìŠ¤ë¥¼ ì—´ì–´ë³´ì„¸ìš”!",
                "choices": ["ì”¬ ì¶”ê°€ ë°©ë²•", "ë‚´ìš© AI ì‘ì„±", "AI ë„êµ¬ ì†Œê°œ"]
            },

            # [ì—¬ìš¸ ì„œë¹„ìŠ¤ ì†Œê°œ]
            {
                "keywords": ['ì—¬ìš¸', 'ì„œë¹„ìŠ¤', 'ì†Œê°œ', 'yeoul', 'ì›Œí„°', 'í”Œë«í¼', 'í™ˆí˜ì´ì§€', 'ì‚¬ì´íŠ¸', 'ë­ì•¼', 'ë¬´ìŠ¨', 'ëˆ„êµ¬'],
                "required": ['ì—¬ìš¸'],
                "answer": "ğŸŒŠ **ì—¬ìš¸(YEOUL) ì„œë¹„ìŠ¤ ì†Œê°œ**\n\nì—¬ìš¸ì€ **AI ê¸°ë°˜ ì¸í„°ë™í‹°ë¸Œ TRPG í”Œë«í¼**ì…ë‹ˆë‹¤.\n\nëˆ„êµ¬ë‚˜ ìƒìƒ ì†ì˜ ëª¨í—˜ì„ **ì‹œë‚˜ë¦¬ì˜¤ë¡œ ì œì‘**í•˜ê³ ,\n**AI ê²Œì„ë§ˆìŠ¤í„°**ì™€ í•¨ê»˜ 1:1ë¡œ ììœ ë¡­ê²Œ í”Œë ˆì´í•  ìˆ˜ ìˆëŠ” ê³µê°„ì…ë‹ˆë‹¤.\n\nì—¬ëŸ¬ë¶„ì˜ ìƒìƒë ¥ì„ ë§ˆìŒê» í¼ì³ë³´ì„¸ìš”!",
                "choices": ["ì‹œë‚˜ë¦¬ì˜¤ ì œì‘ ë°©ë²•", "ê²Œì„ í”Œë ˆì´ ë°©ë²•", "ìš”ê¸ˆì œ ì•ˆë‚´"]
            },

            # [ì¸ì‚¬/ì´ˆê¸°í™”]
            {
                "keywords": ['ì²˜ìŒ', 'ì‹œì‘', 'start', 'home', 'ë©”ì¸', 'reset', 'ë¦¬ì…‹', 'ì•ˆë…•', 'ë°˜ê°€', 'hi'],
                "required": [],
                "answer": "ì•ˆë…•í•˜ì„¸ìš”! ëª¨í—˜ê°€ë‹˜. ğŸ‘‹\nì €ëŠ” TRPG Studioì˜ ì•ˆë‚´ë¥¼ ë•ëŠ” AI ê°€ì´ë“œ 'ì—¬ìš¸'ì…ë‹ˆë‹¤.\në¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?",
                "choices": ["ì‹œë‚˜ë¦¬ì˜¤ ì œì‘ ë°©ë²•", "ìš”ê¸ˆì œ ì•ˆë‚´", "ê²Œì„ í”Œë ˆì´ ë°©ë²•"]
            }
        ]

        # [ë§¤ì¹­ ë¡œì§]
        best_match = None
        max_score = 0

        for item in responses:
            score = 0
            # í•„ìˆ˜ ë‹¨ì–´ ì²´í¬ (ìˆë‹¤ë©´)
            if item.get("required") and not any(r in query for r in item["required"]):
                continue

            # í‚¤ì›Œë“œ ì ìˆ˜ ê³„ì‚°
            for k in item.get("keywords", []):
                if k in query:
                    score += 1

            # ì ìˆ˜ê°€ ë” ë†’ìœ¼ë©´ ê°±ì‹  (ê°™ì€ ì ìˆ˜ë©´ ë¦¬ìŠ¤íŠ¸ ìœ„ìª½ ìš°ì„ )
            if score > max_score:
                max_score = score
                best_match = item

        if best_match:
            # [DB ì—°ë™ ë£° ì²˜ë¦¬] (ì¸ê¸° ì‹œë‚˜ë¦¬ì˜¤ ë“±)
            if best_match.get("type") == "db_popular":
                # ... (DB ë¡œì§ ìœ ì§€) ...
                pass

            return {
                "answer": best_match["answer"],
                "choices": best_match["choices"]
            }

        # ê¸°ë³¸ ì‘ë‹µ
        return {
            "answer": f"ì£„ì†¡í•©ë‹ˆë‹¤. ë§ì”€í•˜ì‹  '{query}'ì— ëŒ€í•œ ì •í™•í•œ ì •ë³´ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì•„ë˜ ë©”ë‰´ë¥¼ í†µí•´ ë„ì›€ì„ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "choices": ["ì‹œë‚˜ë¦¬ì˜¤ ì œì‘ ë°©ë²•", "ìš”ê¸ˆì œ ì•ˆë‚´", "ë¬¸ì˜í•˜ê¸°"]
        }